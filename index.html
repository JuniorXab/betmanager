<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BetManager Pro</title>
<style>
:root {
  --primary:#1e3799; --secondary:#4a69bd; --success:#00b894; --danger:#d63031;
  --void:#f39c12; --pending:#6c757d; --bg:#f5f6fa; --card-bg:#ffffff;
  --text-dark:#2d3436; --text-muted:#636e72; --border:#dcdde1;
  --input-bg:#fafafa; --input-focus:#ffffff;
}
body.dark {
  --primary:#5e8bff; --secondary:#7ba7ff; --success:#00e5a0; --danger:#ff6b7a;
  --void:#ffc14d; --bg:#0f1117; --card-bg:#1a1d27; --text-dark:#e8ecf0;
  --text-muted:#8892a4; --border:#2a2f3e; --input-bg:#13151f; --input-focus:#1e2230;
}
body.dark .bank-card { background: linear-gradient(135deg,#162060,#2a3a7a); }
body.dark .history-item { background: var(--card-bg); }
body.dark .counters { background: var(--card-bg); }
body.dark .edu-item { background: var(--card-bg); }
body.dark .combi-sel-card { background: var(--input-bg); }
body.dark .combi-summary { background: linear-gradient(135deg,#13172a,#1e2230); }
body.dark .combi-picks { background: var(--input-bg); }
body.dark .stake-box { background: #13172a; }
body.dark .section-title { background: #13172a; color: var(--primary); }
body.dark .analisis-bar-track { background: var(--border); }
body.dark .consejo-card { background: #13172a; }
body.dark .consejo-card.warning { background: #1f1a0f; }
body.dark .consejo-card.danger  { background: #1f0f0f; }
body.dark .consejo-card.success { background: #0f1f18; }
body.dark .bw-item { background: var(--input-bg); }
body.dark .btn-secondary { background: #2a2f3e; color: var(--text-dark); }
body.dark .reto-template-card { background: var(--input-bg); }
body.dark .reto-bet-item { background: var(--input-bg); }
body.dark .bank-log-item { background: var(--input-bg); }
body.dark nav button:hover { background: #13172a; }
body.dark nav button.active-nav { background: #13172a; }
body.dark .filters button { background: var(--border); color: var(--text-dark); }
body.dark .nota-display { background: rgba(255,255,255,0.04); border-left-color: var(--border); }
body.dark .reto-past-item { background: var(--input-bg); }
body.dark .meta-bar-track { background: var(--border); }
body.dark .reto-setup { background: var(--card-bg); }
body.dark .reto-setup-info-box { background: var(--input-bg); }
* { box-sizing:border-box; font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; margin:0; padding:0; }
body { background:var(--bg); color:var(--text-dark); padding:10px; display:flex; justify-content:center; }
#app-container { width:100%; max-width:500px; padding-bottom:60px; }
nav { display:flex; flex-wrap:wrap; gap:4px; justify-content:center; background:var(--card-bg); padding:8px; border-radius:12px; margin-bottom:14px; box-shadow:0 4px 6px rgba(0,0,0,0.07); }
nav button { flex:1; min-width:55px; background:none; border:none; font-size:0.68rem; font-weight:600; color:var(--text-muted); padding:7px 3px; cursor:pointer; border-radius:6px; transition:all .2s; }
nav button:hover { background:#f0f4ff; color:var(--primary); }
nav button.active-nav { background:#e8eeff; color:var(--primary); }
.logout-btn { color:var(--danger) !important; }
.view { display:none; animation:fadeIn .3s ease; }
.view.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
.card { background:var(--card-bg); padding:18px; border-radius:16px; margin-bottom:14px; box-shadow:0 4px 12px rgba(0,0,0,0.06); }
.app-title { text-align:center; color:var(--primary); font-size:1.8rem; margin-bottom:6px; font-weight:800; }
.app-subtitle { text-align:center; color:var(--text-muted); font-size:0.8rem; margin-bottom:18px; }
.bank-card { background:linear-gradient(135deg,#1e3799,#4a69bd); color:white; text-align:center; }
.bank-card small { font-size:0.72rem; text-transform:uppercase; letter-spacing:1.5px; opacity:0.8; }
.bank-card h2 { font-size:2.2rem; margin:6px 0 10px; font-weight:800; }
.bank-setup { background:rgba(255,255,255,0.12); padding:12px; border-radius:10px; }
.bank-tip { font-size:0.78rem; text-align:left; opacity:0.85; margin-bottom:10px; line-height:1.5; }
.bank-actions { display:flex; gap:8px; margin-top:10px; }
.bank-actions button { flex:1; padding:9px; font-size:0.78rem; border-radius:8px; }
label { display:block; font-size:0.78rem; font-weight:700; margin-bottom:4px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; }
input,select { width:100%; padding:10px 12px; margin-bottom:11px; border:1.5px solid var(--border); border-radius:8px; font-size:0.93rem; background:var(--input-bg); color:var(--text-dark); transition:border-color .2s; }
input:focus,select:focus { outline:none; border-color:var(--primary); background:var(--input-focus); }
input[readonly] { background:var(--input-bg); font-weight:700; color:var(--primary); cursor:default; }
textarea { width:100%; padding:10px 12px; margin-bottom:11px; border:1.5px solid var(--border); border-radius:8px; font-size:0.9rem; background:var(--input-bg); color:var(--text-dark); resize:vertical; font-family:inherit; transition:border-color .2s; }
textarea:focus { outline:none; border-color:var(--primary); background:var(--input-focus); }
hr { border:0; border-top:1px solid var(--border); margin:13px 0; }
.row { display:flex; gap:10px; align-items:flex-end; }
.col { flex:1; }
.section-title { font-size:0.68rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; color:var(--primary); background:#eef2ff; padding:6px 12px; border-radius:6px; margin-bottom:13px; }
.stake-box { background:#f0f4ff; padding:13px; border-radius:10px; border:1.5px dashed var(--secondary); margin-bottom:13px; }
.stake-box label { color:var(--primary); font-size:0.83rem; margin-bottom:5px; }
.stake-box input[type=range] { margin:7px 0; accent-color:var(--primary); }
.auto-calc { font-size:0.8rem; color:var(--primary); text-align:center; }
.dyn-box { background:var(--input-bg); padding:13px; border-left:3px solid var(--primary); margin-bottom:13px; border-radius:0 8px 8px 0; }
button { width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:8px; font-weight:700; font-size:0.93rem; cursor:pointer; transition:opacity .2s,transform .1s; }
button:hover { opacity:.9; }
button:active { transform:scale(.98); }
.btn-secondary { background:#dfe4ea; color:var(--text-dark); }
.btn-success { background:var(--success); }
.btn-danger { background:var(--danger); }
.btn-warning { background:var(--void); color:#1a1a1a; }
.btn-text { background:none; color:var(--text-muted); text-decoration:underline; font-size:0.83rem; padding:7px; }
.stats-header { display:flex; justify-content:space-between; text-align:center; }
.stat-col { flex:1; }
.stat-col b { display:block; font-size:0.65rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:3px; }
.stat-col span { font-size:1.15rem; font-weight:800; color:var(--primary); }
.counters { display:flex; justify-content:space-around; font-size:0.8rem; margin-bottom:11px; background:var(--card-bg); padding:10px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.05); }
.filters { display:flex; gap:5px; margin-bottom:13px; overflow-x:auto; padding-bottom:4px; }
.filters button { padding:6px 11px; font-size:0.76rem; background:var(--border); color:var(--text-dark); border-radius:20px; min-width:fit-content; white-space:nowrap; width:auto; }
.filters button.active-filter { background:var(--primary); color:white; }
.history-item { background:var(--card-bg); padding:13px; border-radius:10px; margin-bottom:9px; border-left:5px solid var(--pending); font-size:0.86rem; box-shadow:0 2px 6px rgba(0,0,0,.05); }
.history-item.win { border-left-color:var(--success); }
.history-item.loss { border-left-color:var(--danger); }
.history-item.void { border-left-color:var(--void); }
.h-head { display:flex; justify-content:space-between; color:var(--text-muted); font-size:0.7rem; margin-bottom:4px; }
.h-title { font-weight:700; font-size:0.92rem; color:var(--text-dark); }
.h-detail { color:var(--primary); font-weight:600; margin:4px 0; display:block; font-size:0.81rem; }
.h-foot { display:flex; justify-content:space-between; border-top:1px dashed var(--border); padding-top:7px; margin-top:7px; font-size:0.79rem; color:var(--text-muted); }
.h-profit { margin-top:5px; text-align:right; font-weight:800; font-size:0.93rem; }
.h-actions { display:flex; gap:5px; margin-top:9px; }
.h-actions button { padding:6px; font-size:0.75rem; border-radius:6px; width:auto; flex:1; }
.nota-display { font-size:0.76rem; color:var(--text-muted); font-style:italic; margin-top:5px; padding:5px 9px; background:rgba(0,0,0,.03); border-radius:6px; border-left:3px solid var(--border); }
#bankroll-chart { width:100%; height:130px; }
.chart-empty { text-align:center; color:var(--text-muted); font-size:0.83rem; padding:36px 0; }
.edu-item { border-left:4px solid var(--secondary); padding:13px; background:var(--card-bg); margin-bottom:9px; border-radius:8px; }
.edu-item h4 { margin:0 0 4px; color:var(--primary); font-size:0.93rem; }
.edu-item p { margin:0; font-size:0.81rem; color:var(--text-muted); line-height:1.5; }
.auth-card { max-width:340px; margin:50px auto 0; }
.dark-toggle { position:fixed; bottom:16px; right:16px; width:44px; height:44px; border-radius:50%; background:var(--primary); color:white; font-size:1.15rem; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 14px rgba(0,0,0,.25); cursor:pointer; border:none; padding:0; z-index:999; width:44px; }
.combi-sel-card { background:var(--input-bg); border:1.5px solid var(--border); border-radius:12px; padding:13px; margin-bottom:11px; position:relative; padding-top:24px; }
.combi-num { position:absolute; top:-9px; left:13px; background:var(--primary); color:white; font-size:0.68rem; font-weight:700; padding:2px 9px; border-radius:10px; }
.remove-btn { position:absolute; top:8px; right:9px; background:none; border:none; color:var(--danger); font-size:1rem; cursor:pointer; width:auto; padding:0; }
.combi-summary { background:linear-gradient(135deg,#f0f4ff,#e8eeff); border:1.5px solid var(--secondary); border-radius:12px; padding:13px 16px; margin-bottom:4px; }
.combi-summary-row { display:flex; justify-content:space-between; align-items:center; padding:4px 0; font-size:0.88rem; color:var(--text-muted); border-bottom:1px solid rgba(0,0,0,.05); }
.combi-summary-row:last-child { border-bottom:none; }
.combi-sel-odds { display:inline-block; background:var(--primary); color:white; font-size:0.73rem; font-weight:700; padding:2px 7px; border-radius:7px; margin-left:5px; }
.combi-picks { margin:5px 0; padding:7px 9px; background:var(--input-bg); border-radius:7px; border-left:3px solid var(--secondary); }
.combi-pick-row { display:flex; justify-content:space-between; font-size:0.76rem; padding:3px 0; border-bottom:1px dashed var(--border); color:var(--text-muted); }
.combi-pick-row:last-child { border-bottom:none; }
.combi-pick-row span:first-child { font-weight:600; color:var(--text-dark); }
.analisis-sport-row { display:flex; flex-direction:column; margin-bottom:13px; }
.analisis-sport-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; }
.analisis-sport-name { font-weight:700; font-size:0.88rem; color:var(--text-dark); }
.analisis-sport-meta { font-size:0.73rem; color:var(--text-muted); }
.analisis-bar-track { height:7px; background:#eef2f5; border-radius:4px; overflow:hidden; }
.analisis-bar-fill { height:100%; border-radius:4px; transition:width .5s ease; }
.analisis-sport-stats { display:flex; justify-content:space-between; margin-top:4px; font-size:0.73rem; color:var(--text-muted); }
.analisis-sport-stats span b { color:var(--text-dark); }
.consejo-card { background:#f8f9ff; border-left:4px solid var(--primary); padding:11px 13px; border-radius:0 10px 10px 0; margin-bottom:9px; }
.consejo-card.warning { border-left-color:var(--void); background:#fffbf0; }
.consejo-card.danger  { border-left-color:var(--danger); background:#fff5f5; }
.consejo-card.success { border-left-color:var(--success); background:#f0faf6; }
.consejo-card h4 { font-size:0.83rem; color:var(--primary); margin-bottom:3px; }
.consejo-card.warning h4 { color:var(--void); }
.consejo-card.danger  h4 { color:var(--danger); }
.consejo-card.success h4 { color:var(--success); }
.consejo-card p { font-size:0.78rem; color:var(--text-muted); margin:0; line-height:1.5; }
.racha-badge { display:inline-flex; gap:3px; justify-content:center; flex-wrap:wrap; margin-top:7px; }
.racha-dot { width:21px; height:21px; border-radius:50%; font-size:0.63rem; display:flex; align-items:center; justify-content:center; font-weight:700; color:white; }
.best-worst-card { display:flex; gap:9px; margin-bottom:13px; }
.bw-item { flex:1; padding:11px; border-radius:10px; background:#f8f9ff; border:1.5px solid var(--border); }
.bw-label { font-size:0.66rem; font-weight:700; text-transform:uppercase; letter-spacing:.5px; margin-bottom:5px; }
.bw-match { font-size:0.78rem; font-weight:700; color:var(--text-dark); margin-bottom:2px; }
.bw-profit { font-size:1.05rem; font-weight:800; }
.bw-meta { font-size:0.7rem; color:var(--text-muted); }
.meta-bar-track { height:10px; background:#eef2f5; border-radius:5px; overflow:hidden; margin:8px 0; }
.meta-bar-fill { height:100%; border-radius:5px; background:var(--success); transition:width .6s ease; }
.bank-log-item { display:flex; justify-content:space-between; align-items:center; padding:9px 12px; background:var(--input-bg); border-radius:8px; margin-bottom:7px; font-size:0.83rem; border-left:3px solid var(--border); }
.reto-template-card { background:var(--input-bg); border:2px solid var(--border); border-radius:14px; padding:16px; margin-bottom:12px; cursor:pointer; transition:all .2s; }
.reto-template-card:hover { border-color:var(--primary); transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,.1); }
.reto-tmpl-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
.reto-tmpl-badge { font-size:1.6rem; font-weight:900; }
.reto-tmpl-name { font-size:0.75rem; font-weight:700; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; }
.reto-tmpl-desc { font-size:0.82rem; color:var(--text-dark); margin-bottom:8px; }
.reto-tmpl-tag { display:inline-block; background:var(--primary); color:white; font-size:0.65rem; padding:2px 8px; border-radius:10px; margin:2px; }
.reto-progress-bar { height:14px; background:var(--border); border-radius:7px; overflow:hidden; margin:10px 0; }
.reto-progress-fill { height:100%; border-radius:7px; background:linear-gradient(90deg,var(--success),#00c9a7); transition:width .5s ease; }
.reto-bank-display { text-align:center; padding:14px; background:linear-gradient(135deg,#1e3799,#4a69bd); border-radius:12px; color:white; margin-bottom:12px; }
.reto-bank-label { font-size:0.72rem; opacity:.8; text-transform:uppercase; letter-spacing:1px; }
.reto-bank-val { font-size:2rem; font-weight:800; }
.reto-bet-item { background:var(--input-bg); padding:10px 12px; border-radius:8px; margin-bottom:7px; border-left:4px solid var(--pending); font-size:0.82rem; }
.reto-bet-item.win { border-left-color:var(--success); }
.reto-bet-item.loss { border-left-color:var(--danger); }
.reto-past-item { background:var(--input-bg); padding:12px; border-radius:10px; margin-bottom:9px; border-left:4px solid var(--border); }
.reto-past-item.completed { border-left-color:var(--success); }
.reto-past-item.failed { border-left-color:var(--danger); }
.modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.75); z-index:500; align-items:center; justify-content:center; padding:20px; }
.modal-overlay.show { display:flex; }
.modal-box { background:var(--card-bg); border-radius:20px; padding:28px 22px; text-align:center; max-width:340px; width:100%; box-shadow:0 20px 60px rgba(0,0,0,.3); animation:fadeIn .3s ease; }
.modal-box h2 { font-size:1.5rem; margin:8px 0 7px; color:var(--text-dark); }
.modal-box p { font-size:0.86rem; color:var(--text-muted); margin-bottom:16px; line-height:1.5; }
.modal-box .emoji { font-size:3.2rem; }
.reto-setup { background:var(--card-bg); border:2px solid var(--primary); border-radius:14px; padding:16px; margin-bottom:14px; }
</style>
</head>
<body>
<div id="app-container">

<nav id="main-nav" style="display:none">
  <button onclick="navTo('view-main')" id="nav-main">ğŸ  Inicio</button>
  <button onclick="navTo('view-football')" id="nav-football">âš½ FÃºtbol</button>
  <button onclick="navTo('view-nba')" id="nav-nba">ğŸ€ NBA</button>
  <button onclick="navTo('view-combi')" id="nav-combi">ğŸ° Combi</button>
  <button onclick="navTo('view-reto')" id="nav-reto">ğŸ† Reto</button>
  <button onclick="navTo('view-stats')" id="nav-stats">ğŸ“Š Historial</button>
  <button onclick="navTo('view-analisis')" id="nav-analisis">ğŸ” AnÃ¡lisis</button>
  <button onclick="navTo('view-edu')" id="nav-edu">ğŸ“– Glosario</button>
  <button class="logout-btn" onclick="logout()">Salir</button>
</nav>

<button class="dark-toggle" id="dark-toggle" onclick="toggleDark()">ğŸŒ™</button>

<!-- AUTH -->
<div id="view-auth" class="view active">
  <h1 class="app-title">BetManager Pro</h1>
  <p class="app-subtitle">Gestiona y analiza tus apuestas deportivas</p>
  <div class="card auth-card">
    <h3 style="margin-bottom:14px;color:var(--primary)">Ingreso al Sistema</h3>
    <label>Correo o Usuario</label>
    <input type="text" id="auth-email" placeholder="usuario@ejemplo.com">
    <label>ContraseÃ±a</label>
    <input type="password" id="auth-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
    <button onclick="login()" style="margin-bottom:9px">Iniciar SesiÃ³n</button>
    <button class="btn-secondary" onclick="register()">Crear Cuenta</button>
  </div>
</div>

<!-- INICIO -->
<div id="view-main" class="view">
  <div class="card bank-card">
    <small>Tu Bankroll Actual (COP)</small>
    <h2 id="bank-display">$0</h2>
    <div id="bank-diff" style="display:none;font-size:0.76rem;font-weight:600;letter-spacing:.5px;margin-bottom:8px"></div>
    <div class="bank-setup" id="bank-setup-div">
      <p class="bank-tip">* MÃ­nimo recomendado: $50,000 COP.<br>* Capital exclusivo para apostar.</p>
      <div class="row">
        <input type="number" id="new-bank-input" placeholder="Ingresa tu Bankroll" style="margin:0">
        <button onclick="setBank()" style="width:auto;padding:10px 14px;margin:0">OK</button>
      </div>
    </div>
    <div id="bank-actions-div" style="display:none" class="bank-actions">
      <button onclick="showBankModal('retirar')" class="btn-secondary" style="font-size:0.78rem">ğŸ’¸ Retirar</button>
      <button onclick="showBankModal('recargar')" style="font-size:0.78rem;background:rgba(255,255,255,0.2)">â• Recargar</button>
    </div>
  </div>
  <div class="card" id="meta-card" style="display:none">
    <div class="section-title">ğŸ¯ Mi Meta</div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
      <span style="font-size:0.82rem;color:var(--text-muted)">Progreso hacia la meta</span>
      <span id="meta-pct" style="font-weight:700;font-size:0.85rem;color:var(--success)">0%</span>
    </div>
    <div class="meta-bar-track"><div class="meta-bar-fill" id="meta-bar" style="width:0%"></div></div>
    <div style="display:flex;justify-content:space-between;font-size:0.78rem;color:var(--text-muted)">
      <span id="meta-current">$0</span><span id="meta-goal-display">$0</span>
    </div>
    <button onclick="editMeta()" class="btn-text" style="margin-top:5px;font-size:0.75rem;padding:3px 0">âœï¸ Cambiar meta</button>
  </div>
  <div class="card" id="meta-setup-card" style="display:none">
    <div class="section-title">ğŸ¯ Establecer Meta</div>
    <p style="font-size:0.8rem;color:var(--text-muted);margin-bottom:10px">Define el bankroll objetivo donde retirarÃ¡s ganancias y reiniciarÃ¡s el ciclo.</p>
    <div class="row">
      <input type="number" id="meta-input" placeholder="Ej: 500000" style="margin:0">
      <button onclick="setMeta()" style="width:auto;padding:10px 14px;margin:0">OK</button>
    </div>
  </div>
  <div class="card stats-header" id="quick-stats" style="display:none">
    <div class="stat-col"><b>Yield</b><span id="qs-yield">0%</span></div>
    <div class="stat-col"><b>Acierto</b><span id="qs-wr">0%</span></div>
    <div class="stat-col"><b>Apuestas</b><span id="qs-count">0</span></div>
    <div class="stat-col"><b>P&G</b><span id="qs-profit">$0</span></div>
  </div>
  <div class="card">
    <div class="section-title">ğŸ“ˆ EvoluciÃ³n del Bankroll</div>
    <canvas id="bankroll-chart"></canvas>
    <p class="chart-empty" id="chart-empty">Registra apuestas para ver tu evoluciÃ³n</p>
  </div>
  <div class="card" id="bank-log-card" style="display:none">
    <div class="section-title">ğŸ“‹ Movimientos de Bankroll</div>
    <div id="bank-log-list"></div>
  </div>
</div>

<!-- FÃšTBOL -->
<div id="view-football" class="view">
  <div class="card">
    <h3 style="margin-bottom:13px;color:var(--primary)">âš½ Nueva Apuesta de FÃºtbol</h3>
    <label>Liga:</label>
    <select id="fb-league" onchange="loadTeams('fb')">
      <option value="">Selecciona Liga...</option>
      <option value="Premier League">ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ Premier League</option>
      <option value="La Liga">ğŸ‡ªğŸ‡¸ La Liga</option>
      <option value="Serie A">ğŸ‡®ğŸ‡¹ Serie A</option>
      <option value="Bundesliga">ğŸ‡©ğŸ‡ª Bundesliga</option>
      <option value="Ligue 1">ğŸ‡«ğŸ‡· Ligue 1</option>
      <option value="Liga BetPlay">ğŸ‡¨ğŸ‡´ Liga BetPlay</option>
      <option value="Champions League">ğŸ‡ªğŸ‡º Champions League</option>
      <option value="Europa League">ğŸŸ  Europa League</option>
      <option value="Liga MX">ğŸ‡²ğŸ‡½ Liga MX</option>
      <option value="Eredivisie">ğŸ‡³ğŸ‡± Eredivisie</option>
      <option value="Liga Argentina">ğŸ‡¦ğŸ‡· Liga Argentina</option>
      <option value="Copa Libertadores">ğŸŒ Copa Libertadores</option>
      <option value="MLS">ğŸ‡ºğŸ‡¸ MLS</option>
    </select>
    <div class="row">
      <div class="col"><label>Local:</label><select id="fb-local" onchange="updateDynamicMarkets('fb')"><option value="">Elige Liga primero</option></select></div>
      <div class="col"><label>Visitante:</label><select id="fb-away" onchange="updateDynamicMarkets('fb')"><option value="">Elige Liga primero</option></select></div>
    </div>
    <hr>
    <label>Tipo de Apuesta:</label>
    <select id="fb-market" onchange="updateDynamicMarkets('fb')">
      <option value="">Selecciona mercado...</option>
      <option value="1X2">1X2 (Ganador)</option>
      <option value="Doble Oportunidad">Doble Oportunidad</option>
      <option value="Ambos Marcan">Ambos Equipos Marcan</option>
      <option value="Goles">Total de Goles</option>
      <option value="Goles 1H">Goles 1Âª Mitad</option>
      <option value="Corners">Tiros de Esquina</option>
      <option value="Tarjetas">Total de Tarjetas</option>
      <option value="Jugador">Props de Jugador</option>
      <option value="Handicap">HÃ¡ndicap Europeo</option>
      <option value="Handicap Asiatico">HÃ¡ndicap AsiÃ¡tico</option>
      <option value="Resultado Exacto">Resultado Exacto</option>
      <option value="Personalizado">âœï¸ Personalizado</option>
    </select>
    <div id="fb-dynamic-container"></div>
    <hr>
    <div class="section-title">ğŸ’° Stake y Cuota</div>
    <div class="stake-box">
      <label>Stake (Confianza 1â€“10): <span id="fb-stake-val">1</span></label>
      <input type="range" id="fb-stake" min="1" max="10" value="1" oninput="calculateBetAmount('fb')">
      <p class="auto-calc">Se invertirÃ¡ el <b id="fb-stake-pct">2%</b> del Bankroll inicial</p>
    </div>
    <div class="row">
      <div class="col"><label>Cuota (@)</label><input type="number" step="0.01" id="fb-odds" placeholder="Ej: 1.80"></div>
      <div class="col"><label>Monto a Apostar</label><input type="number" id="fb-money" readonly></div>
    </div>
    <label>Resultado:</label>
    <select id="fb-result">
      <option value="Pendiente">â³ Pendiente</option>
      <option value="Ganada">âœ… Ganada</option>
      <option value="Perdida">âŒ Perdida</option>
      <option value="Nula">ğŸ”„ Nula (Void)</option>
    </select>
    <label>Notas (opcional)</label>
    <textarea id="fb-notes" rows="2" placeholder="Ej: Local en racha, portero titular descansa..."></textarea>
    <div class="row">
      <button onclick="saveBet('FÃºtbol')" class="btn-success">âœ” Guardar</button>
      <button onclick="clearForm('fb')" class="btn-secondary" style="width:110px">Limpiar</button>
    </div>
  </div>
</div>

<!-- NBA -->
<div id="view-nba" class="view">
  <div class="card">
    <h3 style="margin-bottom:13px;color:var(--primary)">ğŸ€ Nueva Apuesta NBA</h3>
    <div class="row">
      <div class="col"><label>Local:</label><select id="nba-local" onchange="updateDynamicMarkets('nba')"></select></div>
      <div class="col"><label>Visitante:</label><select id="nba-away" onchange="updateDynamicMarkets('nba')"></select></div>
    </div>
    <hr>
    <label>Tipo de Apuesta:</label>
    <select id="nba-market" onchange="updateDynamicMarkets('nba')">
      <option value="">Selecciona mercado...</option>
      <optgroup label="â”€â”€ PARTIDO COMPLETO â”€â”€">
        <option value="Ganador">Ganador (ML)</option>
        <option value="Handicap">HÃ¡ndicap (Spread)</option>
        <option value="Puntos Totales">Puntos Totales (O/U)</option>
      </optgroup>
      <optgroup label="â”€â”€ PRIMERA MITAD â”€â”€">
        <option value="Ganador 1H">Ganador 1Âª Mitad</option>
        <option value="Puntos 1H">Puntos Totales 1Âª Mitad</option>
      </optgroup>
      <optgroup label="â”€â”€ CUARTOS â”€â”€">
        <option value="Ganador Cuarto">Ganador por Cuarto</option>
        <option value="Puntos Cuarto">Puntos Totales por Cuarto</option>
      </optgroup>
      <optgroup label="â”€â”€ JUGADOR â”€â”€">
        <option value="Props Jugador">Props de Jugador</option>
        <option value="Doble Doble">Doble-Doble</option>
        <option value="Triple Doble">Triple-Doble</option>
      </optgroup>
      <option value="Personalizado NBA">âœï¸ Personalizado</option>
    </select>
    <div id="nba-dynamic-container"></div>
    <hr>
    <div class="section-title">ğŸ’° Stake y Cuota</div>
    <div class="stake-box">
      <label>Stake (Confianza 1â€“10): <span id="nba-stake-val">1</span></label>
      <input type="range" id="nba-stake" min="1" max="10" value="1" oninput="calculateBetAmount('nba')">
      <p class="auto-calc">Se invertirÃ¡ el <b id="nba-stake-pct">2%</b> del Bankroll inicial</p>
    </div>
    <div class="row">
      <div class="col"><label>Cuota (@)</label><input type="number" step="0.01" id="nba-odds" placeholder="Ej: 1.90"></div>
      <div class="col"><label>Monto a Apostar</label><input type="number" id="nba-money" readonly></div>
    </div>
    <label>Resultado:</label>
    <select id="nba-result">
      <option value="Pendiente">â³ Pendiente</option>
      <option value="Ganada">âœ… Ganada</option>
      <option value="Perdida">âŒ Perdida</option>
      <option value="Nula">ğŸ”„ Nula (Void)</option>
    </select>
    <label>Notas (opcional)</label>
    <textarea id="nba-notes" rows="2" placeholder="Ej: Back-to-back, baja estrella..."></textarea>
    <div class="row">
      <button onclick="saveBet('NBA')" class="btn-success">âœ” Guardar</button>
      <button onclick="clearForm('nba')" class="btn-secondary" style="width:110px">Limpiar</button>
    </div>
  </div>
</div>

<!-- COMBINADA -->
<div id="view-combi" class="view">
  <div class="card">
    <h3 style="margin-bottom:4px;color:var(--primary)">ğŸ° Apuesta Combinada</h3>
    <p style="font-size:0.76rem;color:var(--text-muted);margin-bottom:14px">AÃ±ade selecciones. La cuota total se calcula automÃ¡ticamente.</p>
    <div id="combi-selections"></div>
    <button onclick="addCombiSelection()" class="btn-secondary" style="margin-bottom:14px;border:1.5px dashed var(--secondary);background:none;color:var(--secondary)">ï¼‹ AÃ±adir selecciÃ³n</button>
    <hr>
    <div class="combi-summary" id="combi-summary" style="display:none">
      <div class="combi-summary-row"><span>Selecciones</span><b id="combi-count">0</b></div>
      <div class="combi-summary-row"><span>Cuota Total</span><b id="combi-total-odds" style="color:var(--primary);font-size:1.05rem">1.00</b></div>
      <div class="combi-summary-row"><span>Ganancia potencial</span><b id="combi-potential" style="color:var(--success)">$0</b></div>
    </div>
    <div class="section-title" style="margin-top:13px">ğŸ’° Stake</div>
    <div class="stake-box">
      <label>Stake (1â€“10): <span id="combi-stake-val">1</span></label>
      <input type="range" id="combi-stake" min="1" max="10" value="1" oninput="updateCombiOdds()">
      <p class="auto-calc">Se invertirÃ¡ el <b id="combi-stake-pct">2%</b> del Bankroll inicial</p>
    </div>
    <div class="row">
      <div class="col"><label>Monto</label><input type="number" id="combi-money" readonly></div>
      <div class="col"><label>Resultado</label>
        <select id="combi-result">
          <option value="Pendiente">â³ Pendiente</option>
          <option value="Ganada">âœ… Ganada</option>
          <option value="Perdida">âŒ Perdida</option>
          <option value="Nula">ğŸ”„ Nula</option>
        </select>
      </div>
    </div>
    <label>Notas (opcional)</label>
    <textarea id="combi-notes" rows="2" placeholder="Ej: Todos locales en racha..."></textarea>
    <div class="row">
      <button onclick="saveCombi()" class="btn-success">âœ” Guardar Combinada</button>
      <button onclick="clearCombi()" class="btn-secondary" style="width:110px">Limpiar</button>
    </div>
  </div>
</div>

<!-- RETOS -->
<div id="view-reto" class="view">
  <div id="reto-home">
    <div class="card">
      <h3 style="margin-bottom:4px;color:var(--primary)">ğŸ† Modo Reto â€“ Escalera</h3>
      <p style="font-size:0.78rem;color:var(--text-muted);margin-bottom:14px">Empieza con un monto, apuesta con disciplina y multiplÃ­calo. Â¡Solo apuestas simples y cuotas controladas!</p>
      <div id="reto-template-list"></div>
    </div>
    <div class="card" id="reto-past-card" style="display:none">
      <div class="section-title">ğŸ“‹ Historial de Retos</div>
      <div id="reto-past-list"></div>
    </div>
  </div>
  <div id="reto-setup-view" style="display:none">
    <div class="card reto-setup">
      <h3 id="reto-setup-title" style="margin-bottom:12px;color:var(--primary)">Configurar Reto</h3>
      <label>Nombre del reto</label>
      <input type="text" id="reto-name" placeholder="Ej: Escalera Mayo">
      <label>Bank inicial del reto (COP)</label>
      <input type="number" id="reto-initial" placeholder="Ej: 50000">
      <label>Deporte preferido</label>
      <select id="reto-sport">
        <option value="FÃºtbol">âš½ FÃºtbol</option>
        <option value="NBA">ğŸ€ NBA</option>
        <option value="Cualquiera">ğŸ¯ Cualquiera</option>
      </select>
      <div id="reto-setup-info" class="reto-setup-info-box" style="padding:12px;border-radius:8px;margin-bottom:12px;font-size:0.8rem;color:var(--text-muted);line-height:1.6"></div>
      <div class="row">
        <button onclick="startReto()" class="btn-success">ğŸš€ Comenzar Reto</button>
        <button onclick="cancelRetoSetup()" class="btn-secondary" style="width:110px">Cancelar</button>
      </div>
    </div>
  </div>
  <div id="reto-active-view" style="display:none">
    <div class="card" style="padding:0;overflow:hidden">
      <div class="reto-bank-display">
        <div class="reto-bank-label">Bank del Reto</div>
        <div class="reto-bank-val" id="reto-current-display">$0</div>
        <div style="font-size:0.75rem;opacity:.8;margin-top:3px">Meta: <span id="reto-goal-display">$0</span></div>
      </div>
      <div style="padding:14px 16px">
        <div style="display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text-muted);margin-bottom:4px">
          <span id="reto-active-name">Reto</span><span id="reto-progress-pct">0%</span>
        </div>
        <div class="reto-progress-bar"><div class="reto-progress-fill" id="reto-progress-fill" style="width:0%"></div></div>
        <div style="display:flex;justify-content:space-between;font-size:0.73rem;color:var(--text-muted)">
          <span id="reto-start-label">Inicio</span><span id="reto-end-label">Meta</span>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="section-title">â• Registrar Apuesta del Reto</div>
      <label>Partido / Evento</label>
      <input type="text" id="reto-match" placeholder="Ej: Real Madrid vs Barcelona">
      <label>Tu selecciÃ³n (Pick)</label>
      <input type="text" id="reto-pick" placeholder="Ej: Gana Real Madrid, Over 1.5...">
      <div class="row">
        <div class="col"><label>Cuota (@)</label><input type="number" step="0.01" id="reto-odds" placeholder="Ej: 1.55"></div>
        <div class="col"><label>Monto apostado</label><input type="number" id="reto-bet-amount" placeholder="COP"></div>
      </div>
      <label>Resultado</label>
      <select id="reto-result">
        <option value="Pendiente">â³ Pendiente</option>
        <option value="Ganada">âœ… Ganada</option>
        <option value="Perdida">âŒ Perdida</option>
        <option value="Nula">ğŸ”„ Nula</option>
      </select>
      <div class="row">
        <button onclick="addRetoBet()" class="btn-success">âœ” Guardar Apuesta</button>
        <button onclick="abandonReto()" class="btn-danger" style="width:140px">ğŸš© Abandonar</button>
      </div>
    </div>
    <div class="card" id="reto-tips-card">
      <div class="section-title">ğŸ’¡ Consejos para este Reto</div>
      <div id="reto-tips-content"></div>
    </div>
    <div class="card">
      <div class="section-title">ğŸ“‹ Apuestas del Reto</div>
      <div id="reto-bets-list"><p style="color:var(--text-muted);font-size:0.83rem;text-align:center;padding:14px 0">Sin apuestas todavÃ­a</p></div>
    </div>
  </div>
</div>

<!-- HISTORIAL -->
<div id="view-stats" class="view">
  <div class="card stats-header">
    <div class="stat-col"><b>Yield</b><span id="st-yield">0%</span></div>
    <div class="stat-col"><b>Acierto</b><span id="st-winrate">0%</span></div>
    <div class="stat-col"><b>P&G</b><span id="st-profit">$0</span></div>
  </div>
  <div class="counters">
    <span>âœ… <b id="st-won">0</b></span>
    <span>âŒ <b id="st-lost">0</b></span>
    <span>â³ <b id="st-pending">0</b></span>
    <span>ğŸ“ <b id="st-total">0</b></span>
  </div>
  <div class="filters">
    <button onclick="renderHistory('Todas',this)" class="active-filter">Todas</button>
    <button onclick="renderHistory('Ganada',this)">âœ… Ganadas</button>
    <button onclick="renderHistory('Perdida',this)">âŒ Perdidas</button>
    <button onclick="renderHistory('Pendiente',this)">â³ Pendientes</button>
    <button onclick="renderHistory('Nula',this)">ğŸ”„ Nulas</button>
  </div>
  <div id="history-list"></div>
  <button onclick="resetHistory()" class="btn-text" style="color:var(--danger);margin-top:9px">âš ï¸ Reiniciar historial</button>
</div>

<!-- ANÃLISIS -->
<div id="view-analisis" class="view">
  <div class="card"><div class="section-title">ğŸ† Mejor y Peor Apuesta</div><div id="analisis-bestworse"><p style="color:var(--text-muted);font-size:0.83rem;text-align:center;padding:14px 0">Sin apuestas resueltas</p></div></div>
  <div class="card">
    <div class="section-title">ğŸ”¥ Racha Actual</div>
    <div id="racha-display" style="text-align:center;padding:8px 0">
      <div id="racha-emoji" style="font-size:2.2rem;margin-bottom:5px">â€”</div>
      <div id="racha-texto" style="font-size:0.95rem;font-weight:700;color:var(--text-dark)">Sin apuestas resueltas</div>
      <div id="racha-sub" style="font-size:0.78rem;color:var(--text-muted);margin-top:3px"></div>
    </div>
  </div>
  <div class="card"><div class="section-title">ğŸ“Š Rendimiento por Deporte</div><div id="analisis-deportes"><p style="color:var(--text-muted);font-size:0.83rem;text-align:center;padding:14px 0">Registra apuestas para ver estadÃ­sticas</p></div></div>
  <div class="card"><div class="section-title">âš½ Rendimiento por Mercado</div><div id="analisis-ligas"><p style="color:var(--text-muted);font-size:0.83rem;text-align:center;padding:14px 0">Sin datos suficientes</p></div></div>
  <div class="card"><div class="section-title">ğŸ’¡ Consejos de GestiÃ³n</div><div id="consejos-list"></div></div>
</div>

<!-- GLOSARIO -->
<div id="view-edu" class="view">
  <h2 style="margin-bottom:13px;color:var(--primary)">Glosario de Apuestas ğŸ“–</h2>
  <div id="diccionario-list"></div>
</div>

</div>

<!-- MODALES -->
<div class="modal-overlay" id="bank-modal">
  <div class="modal-box">
    <div class="emoji" id="bank-modal-emoji">ğŸ’¸</div>
    <h2 id="bank-modal-title">Retirar</h2>
    <p id="bank-modal-desc">Ingresa el monto a retirar de tu bankroll.</p>
    <input type="number" id="bank-modal-input" placeholder="Monto en COP" style="margin-bottom:12px">
    <button onclick="confirmBankAction()" class="btn-success" style="margin-bottom:8px" id="bank-modal-btn">Confirmar</button>
    <button onclick="closeBankModal()" class="btn-secondary">Cancelar</button>
  </div>
</div>
<div class="modal-overlay" id="meta-modal">
  <div class="modal-box">
    <div class="emoji">ğŸ‰</div>
    <h2>Â¡Meta alcanzada!</h2>
    <p>Has llegado a tu objetivo de bankroll. Momento de retirar ganancias y reiniciar el ciclo con disciplina.</p>
    <button onclick="document.getElementById('meta-modal').classList.remove('show')" class="btn-success">Â¡Entendido!</button>
  </div>
</div>
<div class="modal-overlay" id="reto-win-modal">
  <div class="modal-box">
    <div class="emoji">ğŸ‰ğŸ†ğŸ‰</div>
    <h2 id="reto-win-title">Â¡Reto Completado!</h2>
    <p id="reto-win-desc">Multiplicaste tu bankroll con Ã©xito.</p>
    <button onclick="restartReto()" class="btn-success" style="margin-bottom:8px">ğŸ” Repetir reto</button>
    <button onclick="endReto()" class="btn-secondary">Volver al inicio</button>
  </div>
</div>
<div class="modal-overlay" id="reto-lose-modal">
  <div class="modal-box">
    <div class="emoji">ğŸ’€</div>
    <h2>Reto fallado</h2>
    <p id="reto-lose-desc">El bank del reto llegÃ³ a cero. Analiza antes de intentarlo de nuevo.</p>
    <button onclick="restartReto()" class="btn-warning" style="margin-bottom:8px">ğŸ” Intentar de nuevo</button>
    <button onclick="endReto()" class="btn-secondary">Volver al inicio</button>
  </div>
</div>

<script>
const DB={
  football:{
    "Premier League":["Arsenal","Aston Villa","Bournemouth","Brentford","Brighton","Chelsea","Crystal Palace","Everton","Fulham","Ipswich Town","Leicester City","Liverpool","Man City","Man Utd","Newcastle","Nottm Forest","Southampton","Tottenham","West Ham","Wolves"],
    "La Liga":["AlavÃ©s","Athletic Club","AtlÃ©tico Madrid","Barcelona","Celta","Espanyol","Getafe","Girona","Las Palmas","LeganÃ©s","Mallorca","Osasuna","Rayo","Betis","Real Madrid","Real Sociedad","Sevilla","Valencia","Valladolid","Villarreal"],
    "Serie A":["Atalanta","Bologna","Cagliari","Como","Empoli","Fiorentina","Genoa","Inter","Juventus","Lazio","Lecce","AC Milan","Monza","Napoli","Parma","Roma","Torino","Udinese","Venezia","Verona"],
    "Bundesliga":["Augsburg","Bayern Munich","Bochum","Dortmund","Frankfurt","Freiburg","Holstein Kiel","Hoffenheim","Leverkusen","Mainz","MÃ¶nchengladbach","RB Leipzig","St. Pauli","Stuttgart","Union Berlin","Werder Bremen"],
    "Ligue 1":["Angers","Auxerre","Brest","Lens","Lille","Lyon","Marseille","Monaco","Montpellier","Nantes","Nice","PSG","Reims","Rennes","Saint-Ã‰tienne","Strasbourg","Toulouse"],
    "Liga BetPlay":["AmÃ©rica","Nacional","Millonarios","Junior","Santa Fe","MedellÃ­n","Tolima","Cali","Once Caldas","Bucaramanga","Pasto","La Equidad","Alianza Petrolera","Envigado"],
    "Champions League":["Arsenal","Aston Villa","AtlÃ©tico Madrid","Barcelona","Bayern Munich","Benfica","Bologna","Brest","Celtic","Club Brugge","Dinamo Zagreb","Dortmund","Feyenoord","Girona","Inter","Juventus","Leverkusen","Lille","Man City","Monaco","PSG","PSV","Porto","RB Leipzig","Real Madrid","Salzburg","Shakhtar","Slavia Praha","Sparta Praha","Sporting CP","Sturm Graz","Young Boys"],
    "Europa League":["Ajax","Anderlecht","Athletic Club","AZ Alkmaar","FCSB","FenerbahÃ§e","Frankfurt","Galatasaray","Hoffenheim","Lazio","Lyon","Man Utd","Midtjylland","Olympiacos","Porto","Rangers","Roma","Slavia Praha","Sociedad","Spurs","Twente","Union SG","Villarreal"],
    "Liga MX":["AmÃ©rica","Atlas","AtlÃ©tico San Luis","Cruz Azul","FC JuÃ¡rez","Guadalajara","LeÃ³n","MazatlÃ¡n","Monterrey","Necaxa","Pachuca","Puebla","QuerÃ©taro","Santos Laguna","Tigres","Tijuana","Toluca","UNAM"],
    "Eredivisie":["Ajax","AZ","FC Utrecht","Feyenoord","Fortuna Sittard","Go Ahead Eagles","Heerenveen","Heracles","NEC","PSV","RKC Waalwijk","Sparta Rotterdam","Twente","Willem II"],
    "Liga Argentina":["Argentinos Jrs","Banfield","Belgrano","Boca Juniors","Central CÃ³rdoba","ColÃ³n","Defensa y Justicia","Estudiantes","Gimnasia","Godoy Cruz","HuracÃ¡n","Independiente","LanÃºs","Newell's","Racing","River Plate","Rosario Central","San Lorenzo","Talleres","Tigre","VÃ©lez"],
    "Copa Libertadores":["AtlÃ©tico Mineiro","Boca Juniors","Botafogo","Colo-Colo","Flamengo","Fluminense","Internacional","Junior","LDU Quito","Libertad","Nacional","Olimpia","Palestino","Palmeiras","PeÃ±arol","Racing","River Plate","SÃ£o Paulo","Talleres"],
    "MLS":["Atlanta United","Austin FC","Charlotte FC","Chicago Fire","Cincinnati","Colorado Rapids","Columbus Crew","Dallas","DC United","Houston Dynamo","Inter Miami","LAFC","LA Galaxy","Minnesota United","Nashville SC","New England","NYCFC","NY Red Bulls","Orlando City","Philadelphia Union","Portland Timbers","Real Salt Lake","San Jose","Seattle Sounders","Sporting KC","St. Louis City","Toronto FC","Vancouver Whitecaps"]
  },
  nba:["Atlanta Hawks","Boston Celtics","Brooklyn Nets","Charlotte Hornets","Chicago Bulls","Cleveland Cavaliers","Dallas Mavericks","Denver Nuggets","Detroit Pistons","Golden State Warriors","Houston Rockets","Indiana Pacers","Los Angeles Clippers","Los Angeles Lakers","Memphis Grizzlies","Miami Heat","Milwaukee Bucks","Minnesota Timberwolves","New Orleans Pelicans","New York Knicks","Oklahoma City Thunder","Orlando Magic","Philadelphia 76ers","Phoenix Suns","Portland Trail Blazers","Sacramento Kings","San Antonio Spurs","Toronto Raptors","Utah Jazz","Washington Wizards"],
  dictionary:[
    {t:"Bankroll",d:"Capital total destinado exclusivamente a apostar. No debe mezclarse con dinero de uso cotidiano."},
    {t:"Flat Staking",d:"Sistema donde siempre apuestas el mismo porcentaje del bankroll inicial. En BetManager: 1 stake = 2% del bank inicial."},
    {t:"P&G (PÃ©rdidas y Ganancias)",d:"Resultado neto total en COP. Suma de ganancias menos pÃ©rdidas. Tu termÃ³metro financiero principal."},
    {t:"Stake",d:"Nivel de confianza del 1 al 10. Stake 1 = 2%, stake 5 = 10%, stake 10 = 20% del bankroll inicial."},
    {t:"Yield",d:"Rentabilidad pura. Beneficio neto Ã· total invertido Ã— 100. Un yield sostenido del 5â€“10% es excelente."},
    {t:"ROI",d:"Return on Investment. Similar al yield en apuestas. Mide el retorno porcentual sobre el capital invertido."},
    {t:"Value Bet",d:"Apuesta de valor. Tu probabilidad estimada es mayor a la implÃ­cita en la cuota. Base del apostador profesional."},
    {t:"Over / Under (O/U)",d:"ApostÃ¡s si el evento producirÃ¡ mÃ¡s o menos de X unidades (goles, puntos, corners, tarjetas)."},
    {t:"CLV (Closing Line Value)",d:"Batir la lÃ­nea de cierre. Si apostÃ¡s a @2.00 y el partido empieza a @1.75, tienes CLV positivo."},
    {t:"Props",d:"Apuestas sobre estadÃ­sticas individuales de jugadores: goles, rebotes, puntos, disparos, etc."},
    {t:"HÃ¡ndicap Europeo",d:"Ventaja/desventaja ficticia en goles. Ej: Real Madrid â€“1 necesita ganar por 2+ para que gane la apuesta."},
    {t:"HÃ¡ndicap AsiÃ¡tico",d:"Variante del hÃ¡ndicap que elimina el empate. Puede ser en 0.25 o 0.75 para dividir la apuesta."},
    {t:"Doble Oportunidad",d:"Cubre dos de los tres resultados: 1X, X2 o 12. Cuota mÃ¡s baja, mayor probabilidad."},
    {t:"Cuota ImplÃ­cita",d:"Probabilidad que refleja la cuota: 1 Ã· cuota Ã— 100. Cuota @2.00 = 50%, @1.50 = 66.7%."},
    {t:"Void / Nula",d:"Apuesta anulada. El dinero se devuelve Ã­ntegro. Ocurre por suspensiÃ³n u otras causas."},
    {t:"Kelly Criterion",d:"FÃ³rmula para la apuesta Ã³ptima: (pÃ—b â€“ q) / b, donde p es tu probabilidad estimada y b = cuotaâ€“1."},
    {t:"Combinada (Parlay)",d:"Une varias selecciones. La cuota total es el producto de todas. Un fallo = se pierde todo."},
    {t:"Moneyline (ML)",d:"Apuesta directa al ganador sin hÃ¡ndicap. Muy usada en NBA y bÃ©isbol."},
    {t:"Spread",d:"HÃ¡ndicap de puntos en NBA/NFL. Lakers â€“5.5 = deben ganar por 6+ puntos."},
    {t:"Sharp / Sharps",d:"Apostadores profesionales. Cuando mueven masivamente un mercado, las casas ajustan las lÃ­neas."},
    {t:"Tilt",d:"Estado emocional que lleva a decisiones irracionales tras pÃ©rdidas. El mayor enemigo del apostador."},
    {t:"Juice / Margen",d:"ComisiÃ³n de la casa. En @1.90/1.90 el margen es ~5.26%. Aposta en casas con menor margen."},
    {t:"Cuota Americana",d:"Positivas (+150): ganas $150 por $100 apostados. Negativas (â€“200): apuestas $200 para ganar $100."},
    {t:"LÃ­nea de Cierre",d:"Cuota definitiva al inicio del evento. Es la referencia mÃ¡s eficiente del mercado."},
    {t:"Cashout",d:"Retiro anticipado antes de que termine el evento. Ãštil para asegurar, pero erosiona el valor esperado."},
    {t:"Doble-Doble NBA",d:"Jugador con dos dÃ­gitos en dos categorÃ­as estadÃ­sticas en un partido (ej: 10+ puntos y 10+ rebotes)."},
    {t:"Triple-Doble NBA",d:"Jugador con dos dÃ­gitos en tres categorÃ­as (ej: puntos, rebotes y asistencias). Muy raro."},
    {t:"Back-to-Back NBA",d:"Equipo que juega en dÃ­as consecutivos. Aumenta el cansancio y puede afectar el rendimiento."},
    {t:"Escalera (Reto)",d:"Sistema donde partes de un monto inicial y el objetivo es multiplicarlo (Ã—3, Ã—5 o Ã—10) con apuestas individuales de cuotas bajas y controladas."}
  ]
};

let userEmail=null, currentBankAction='', pendingRetoType=null;
let appData={bank:0,initialBank:0,history:[],bankLog:[],goal:0,activeReto:null,retoHistory:[]};

const RETO_TEMPLATES={
  X3:{label:'X3',mult:3,color:'#00b894',desc:'Multiplica tu bankroll por 3. El reto mÃ¡s accesible para empezar.',cuotaRec:'1.40â€“1.60',stakeRec:'6â€“8% por apuesta',pasos:'~10â€“15 apuestas',tips:['Apuesta solo al ganador del partido (1X2) en favoritos claros.','Cuotas entre 1.40 y 1.60. Consistencia sobre todo.','MÃ¡ximo 1 apuesta por dÃ­a. La paciencia es tu mejor aliada.','Evita combinadas: un fallo lo pierde todo.','Si pierdes 2 seguidas, para y analiza antes de continuar.']},
  X5:{label:'X5',mult:5,color:'#4a69bd',desc:'El clÃ¡sico de los apostadores disciplinados. Requiere paciencia.',cuotaRec:'1.50â€“1.80',stakeRec:'4â€“6% por apuesta',pasos:'~18â€“25 apuestas',tips:['Cuotas entre 1.50 y 1.80 en mercados de alta probabilidad.','1X2 en favoritos, Over/Under de goles en lÃ­nea 1.5 o 2.5.','Un error seguido de impulsividad arruina el reto. Respira.','Lleva un registro mental de por quÃ© haces cada apuesta.','Si el bank cae un 30%, pausa de 48 horas mÃ­nimo.']},
  X10:{label:'X10',mult:10,color:'#d63031',desc:'El reto mÃ¡ximo. Solo para apostadores muy disciplinados.',cuotaRec:'1.60â€“2.00',stakeRec:'4% por apuesta (stake 2)',pasos:'~30â€“40 apuestas',tips:['El reto mÃ¡s largo. La disciplina mental lo es todo.','Cuotas entre 1.60 y 2.00. Nunca subas por emociÃ³n.','Solo 1 apuesta por dÃ­a como mÃ¡ximo. Calidad, no cantidad.','Analiza cada partido al menos 30 minutos antes de apostar.','No cambies de deporte ni de mercado durante el reto.']}
};

window.onload=()=>{
  if(localStorage.getItem('bmDark')){document.body.classList.add('dark');document.getElementById('dark-toggle').innerText='â˜€ï¸';}
  const dic=document.getElementById('diccionario-list');
  DB.dictionary.forEach(d=>dic.innerHTML+=`<div class="edu-item"><h4>${d.t}</h4><p>${d.d}</p></div>`);
  const nL=document.getElementById('nba-local'),nA=document.getElementById('nba-away');
  DB.nba.sort().forEach(t=>{nL.innerHTML+=`<option value="${t}">${t}</option>`;nA.innerHTML+=`<option value="${t}">${t}</option>`;});
  renderRetoTemplates();
  const active=localStorage.getItem('activeUser');
  if(active){userEmail=active;loadUserData();document.getElementById('main-nav').style.display='flex';navTo('view-main');}
};

function navTo(id){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('nav button[id^="nav-"]').forEach(b=>b.classList.remove('active-nav'));
  document.getElementById(id).classList.add('active');
  const map={'view-main':'nav-main','view-football':'nav-football','view-nba':'nav-nba','view-combi':'nav-combi','view-reto':'nav-reto','view-stats':'nav-stats','view-analisis':'nav-analisis','view-edu':'nav-edu'};
  if(map[id])document.getElementById(map[id]).classList.add('active-nav');
  if(id==='view-stats')renderHistory('Todas',null);
  if(id==='view-main'){updateQuickStats();drawChart();updateBankLog();}
  if(id==='view-combi'&&!document.getElementById('combi-selections').children.length)addCombiSelection();
  if(id==='view-analisis')renderAnalisis();
  if(id==='view-reto')renderRetoView();
}

function register(){
  const e=document.getElementById('auth-email').value.trim(),p=document.getElementById('auth-pass').value;
  if(!e||!p)return alert("Ingresa usuario y contraseÃ±a.");
  let u=JSON.parse(localStorage.getItem('bmUsers'))||{};
  if(u[e])return alert("El usuario ya existe.");
  u[e]={pass:p,bank:0,initialBank:0,history:[],bankLog:[],goal:0,activeReto:null,retoHistory:[]};
  localStorage.setItem('bmUsers',JSON.stringify(u));alert("âœ… Cuenta creada. Inicia sesiÃ³n.");
}
function login(){
  const e=document.getElementById('auth-email').value.trim(),p=document.getElementById('auth-pass').value;
  let u=JSON.parse(localStorage.getItem('bmUsers'))||{};
  if(u[e]&&u[e].pass===p){userEmail=e;localStorage.setItem('activeUser',e);loadUserData();document.getElementById('main-nav').style.display='flex';navTo('view-main');}
  else alert("âŒ Datos incorrectos.");
}
function logout(){localStorage.removeItem('activeUser');userEmail=null;document.getElementById('main-nav').style.display='none';document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));document.getElementById('view-auth').classList.add('active');}
function loadUserData(){const u=JSON.parse(localStorage.getItem('bmUsers'));appData={bank:0,initialBank:0,history:[],bankLog:[],goal:0,activeReto:null,retoHistory:[],...u[userEmail]};updateBankUI();}
function saveUserData(){const u=JSON.parse(localStorage.getItem('bmUsers'));u[userEmail]=appData;localStorage.setItem('bmUsers',JSON.stringify(u));updateBankUI();}

function setBank(){
  const v=parseFloat(document.getElementById('new-bank-input').value);
  if(v>0){appData.bank=v;appData.initialBank=v;appData.bankLog=appData.bankLog||[];appData.bankLog.unshift({type:'inicio',amount:v,date:new Date().toLocaleDateString('es-CO'),note:'Bankroll inicial'});saveUserData();document.getElementById('new-bank-input').value='';calculateBetAmount('fb');calculateBetAmount('nba');}
}
function updateBankUI(){
  document.getElementById('bank-display').innerText='$'+appData.bank.toLocaleString('es-CO');
  const diff=appData.bank-(appData.initialBank||appData.bank);
  const diffEl=document.getElementById('bank-diff');
  if(appData.initialBank&&diff!==0){diffEl.innerText=(diff>=0?'â–² +':'â–¼ ')+'$'+Math.abs(diff).toLocaleString('es-CO')+' vs inicio';diffEl.style.color=diff>=0?'#a8edda':'#ffb3b3';diffEl.style.display='block';}
  else diffEl.style.display='none';
  const hasBank=appData.bank>0||appData.initialBank>0;
  document.getElementById('bank-setup-div').style.display=hasBank?'none':'block';
  document.getElementById('bank-actions-div').style.display=hasBank?'flex':'none';
  updateMetaUI();calculateBetAmount('fb');calculateBetAmount('nba');
  const hasGoal=appData.goal>0;
  document.getElementById('meta-card').style.display=(hasBank&&hasGoal)?'block':'none';
  document.getElementById('meta-setup-card').style.display=(hasBank&&!hasGoal)?'block':'none';
}
function showBankModal(type){
  currentBankAction=type;const isR=type==='retirar';
  document.getElementById('bank-modal-emoji').innerText=isR?'ğŸ’¸':'â•';
  document.getElementById('bank-modal-title').innerText=isR?'Retirar del Bankroll':'Recargar Bankroll';
  document.getElementById('bank-modal-desc').innerText=isR?'Ingresa el monto a retirar. El bankroll inicial no cambia.':'Ingresa el monto a aÃ±adir al bankroll.';
  document.getElementById('bank-modal-btn').innerText=isR?'ğŸ’¸ Retirar':'â• Recargar';
  document.getElementById('bank-modal-input').value='';
  document.getElementById('bank-modal').classList.add('show');
}
function closeBankModal(){document.getElementById('bank-modal').classList.remove('show');}
function confirmBankAction(){
  const v=parseFloat(document.getElementById('bank-modal-input').value);
  if(!v||v<=0)return alert("Monto invÃ¡lido.");
  if(currentBankAction==='retirar'){if(v>appData.bank)return alert("Saldo insuficiente.");appData.bank-=v;appData.bankLog.unshift({type:'retiro',amount:v,date:new Date().toLocaleDateString('es-CO'),note:'Retiro parcial'});}
  else{appData.bank+=v;appData.bankLog.unshift({type:'recarga',amount:v,date:new Date().toLocaleDateString('es-CO'),note:'Recarga de bankroll'});}
  saveUserData();closeBankModal();updateBankLog();alert('âœ… '+( currentBankAction==='retirar'?'Retiro':'Recarga')+' de $'+v.toLocaleString('es-CO')+' registrado.');
}
function updateBankLog(){
  const logCard=document.getElementById('bank-log-card'),logList=document.getElementById('bank-log-list');
  if(!appData.bankLog||!appData.bankLog.length){logCard.style.display='none';return;}
  logCard.style.display='block';
  const icons={inicio:'ğŸ¦',retiro:'ğŸ’¸',recarga:'â•'},colors={inicio:'var(--primary)',retiro:'var(--danger)',recarga:'var(--success)'};
  logList.innerHTML=appData.bankLog.slice(0,8).map(l=>`<div class="bank-log-item" style="border-left-color:${colors[l.type]}"><div><div style="font-weight:700;font-size:0.83rem">${icons[l.type]} ${l.note}</div><div style="font-size:0.72rem;color:var(--text-muted)">${l.date}</div></div><div style="font-weight:800;color:${colors[l.type]}">${l.type==='retiro'?'-':'+'} $${l.amount.toLocaleString('es-CO')}</div></div>`).join('');
}
function setMeta(){const v=parseFloat(document.getElementById('meta-input').value);if(v>0&&v>appData.bank){appData.goal=v;saveUserData();updateMetaUI();}else alert("La meta debe ser mayor a tu bankroll actual.");}
function editMeta(){appData.goal=0;saveUserData();document.getElementById('meta-card').style.display='none';document.getElementById('meta-setup-card').style.display='block';}
function updateMetaUI(){
  if(!appData.goal||appData.goal<=0)return;
  const pct=Math.min((appData.bank/appData.goal)*100,100);
  document.getElementById('meta-bar').style.width=pct+'%';
  document.getElementById('meta-pct').innerText=pct.toFixed(1)+'%';
  document.getElementById('meta-current').innerText='$'+appData.bank.toLocaleString('es-CO');
  document.getElementById('meta-goal-display').innerText='Meta: $'+appData.goal.toLocaleString('es-CO');
  if(pct>=100)document.getElementById('meta-modal').classList.add('show');
}

function calculateBetAmount(sport){
  const stake=document.getElementById(`${sport}-stake`).value,pct=stake*2;
  document.getElementById(`${sport}-stake-val`).innerText=stake;
  document.getElementById(`${sport}-stake-pct`).innerText=pct+'%';
  const base=appData.initialBank||appData.bank;
  document.getElementById(`${sport}-money`).value=Math.round(base*(pct/100))||'';
}

function loadTeams(sport){
  if(sport!=='fb')return;
  const league=document.getElementById('fb-league').value;
  const sL=document.getElementById('fb-local'),sA=document.getElementById('fb-away');
  sL.innerHTML='<option value="">Elige local</option>';sA.innerHTML='<option value="">Elige visitante</option>';
  (DB.football[league]||[]).forEach(t=>{sL.innerHTML+=`<option value="${t}">${t}</option>`;sA.innerHTML+=`<option value="${t}">${t}</option>`;});
  document.getElementById('fb-dynamic-container').innerHTML='';
}

function genLines(from,to,step=1){const l=[];for(let v=from;v<=to;v+=step)l.push((Math.round(v*10)/10).toFixed(1));return l;}
function lineOpts(lines){return lines.map(l=>`<option value="${l}">${l}</option>`).join('');}

function updateDynamicMarkets(sport){
  const local=document.getElementById(`${sport}-local`).value||'Local';
  const away=document.getElementById(`${sport}-away`).value||'Visitante';
  const market=document.getElementById(`${sport}-market`).value;
  const box=document.getElementById(`${sport}-dynamic-container`);
  box.innerHTML='';if(!market)return;box.className='dyn-box';
  if(sport==='fb'){
    const gL=lineOpts(genLines(0.5,6.5)),cL=lineOpts(genLines(0.5,15.5)),cTL=lineOpts(genLines(0.5,10.5)),tL=lineOpts(genLines(0.5,15.5));
    switch(market){
      case '1X2':box.innerHTML=`<label>SelecciÃ³n:</label><select id="dyn-sel1"><option>Gana ${local}</option><option>Empate</option><option>Gana ${away}</option></select>`;break;
      case 'Doble Oportunidad':box.innerHTML=`<label>SelecciÃ³n:</label><select id="dyn-sel1"><option>${local} o Empate (1X)</option><option>${away} o Empate (X2)</option><option>${local} o ${away} (12)</option></select>`;break;
      case 'Ambos Marcan':box.innerHTML=`<label>Â¿Ambos equipos marcan?</label><select id="dyn-sel1"><option value="SÃ­">SÃ­</option><option value="No">No</option></select>`;break;
      case 'Goles':case 'Goles 1H':box.innerHTML=`<label>Equipo / Partido:</label><select id="dyn-sel1"><option>Total del Partido</option><option value="${local}">${local}</option><option value="${away}">${away}</option></select><div class="row"><div class="col"><label>Dir.:</label><select id="dyn-sel2"><option>MÃ¡s de (+)</option><option>Menos de (-)</option></select></div><div class="col"><label>LÃ­nea:</label><select id="dyn-sel3">${gL}</select></div></div>`;break;
      case 'Corners':box.innerHTML=`<label>Equipo / Partido:</label><select id="dyn-sel1" onchange="updateCornersLines()"><option value="total">Total</option><option value="${local}">${local}</option><option value="${away}">${away}</option></select><div class="row"><div class="col"><label>Dir.:</label><select id="dyn-sel2"><option>MÃ¡s de (+)</option><option>Menos de (-)</option></select></div><div class="col"><label>LÃ­nea:</label><select id="dyn-sel3">${cL}</select></div></div>`;break;
      case 'Tarjetas':box.innerHTML=`<label>Equipo / Partido:</label><select id="dyn-sel1"><option value="total">Total</option><option value="${local}">${local}</option><option value="${away}">${away}</option></select><label>Tipo:</label><select id="dyn-sel2"><option>Tarjetas Totales</option><option>Solo Amarillas</option><option>Solo Rojas</option></select><div class="row"><div class="col"><label>Dir.:</label><select id="dyn-sel3"><option>MÃ¡s de</option><option>Menos de</option></select></div><div class="col"><label>LÃ­nea:</label><select id="dyn-sel4">${tL}</select></div></div>`;break;
      case 'Jugador':box.innerHTML=`<label>Jugador:</label><input type="text" id="dyn-sel1" placeholder="Nombre del jugador"><label>EstadÃ­stica:</label><select id="dyn-sel2"><option>Disparos a puerta</option><option>Disparos totales</option><option>Asistencias</option><option>Goleador (Anota)</option><option>Gol o Asistencia</option><option>Pases clave</option></select><div class="row"><div class="col"><label>Dir.:</label><select id="dyn-sel3"><option>MÃ¡s de (+)</option><option>Menos de (-)</option></select></div><div class="col"><label>LÃ­nea:</label><input type="number" step="0.5" id="dyn-sel4" placeholder="Ej: 1.5"></div></div>`;break;
      case 'Handicap':box.innerHTML=`<label>Equipo:</label><select id="dyn-sel1"><option value="${local}">${local}</option><option value="${away}">${away}</option></select><label>HÃ¡ndicap:</label><input type="text" id="dyn-sel2" placeholder="Ej: â€“1 o +0.5">`;break;
      case 'Handicap Asiatico':box.innerHTML=`<label>Equipo:</label><select id="dyn-sel1"><option value="${local}">${local}</option><option value="${away}">${away}</option></select><label>LÃ­nea asiÃ¡tica:</label><select id="dyn-sel2">${['-2','-1.75','-1.5','-1.25','-1','-0.75','-0.5','-0.25','0','+0.25','+0.5','+0.75','+1','+1.25','+1.5','+1.75','+2'].map(v=>`<option>${v}</option>`).join('')}</select>`;break;
      case 'Resultado Exacto':box.innerHTML=`<label>Resultado exacto:</label><select id="dyn-sel1">${['0-0','1-0','0-1','1-1','2-0','0-2','2-1','1-2','2-2','3-0','0-3','3-1','1-3','3-2','2-3','3-3','4-0','0-4'].map(r=>`<option>${r}</option>`).join('')}</select>`;break;
      case 'Personalizado':box.innerHTML=`<label>Describe tu apuesta:</label><input type="text" id="dyn-sel1" placeholder="Escribe el mercado y selecciÃ³n...">`;break;
    }
  }else{
    const ptL=lineOpts(genLines(150.5,280.5,5)),hL=lineOpts(genLines(90.5,160.5,5)),qL=lineOpts(genLines(40.5,75.5,2.5));
    switch(market){
      case 'Ganador':box.innerHTML=`<label>Ganador:</label><select id="nba-dyn1"><option value="${local}">${local}</option><option value="${away}">${away}</option></select>`;break;
      case 'Handicap':box.innerHTML=`<label>Equipo:</label><select id="nba-dyn1"><option value="${local}">${local}</option><option value="${away}">${away}</option></select><label>Spread:</label><input type="text" id="nba-dyn2" placeholder="Ej: â€“5.5 o +3.5">`;break;
      case 'Puntos Totales':box.innerHTML=`<div class="row"><div class="col"><label>Dir.:</label><select id="nba-dyn1"><option>MÃ¡s de (+)</option><option>Menos de (-)</option></select></div><div class="col"><label>LÃ­nea:</label><select id="nba-dyn2">${ptL}</select></div></div>`;break;
      case 'Ganador 1H':box.innerHTML=`<label>Ganador 1Âª Mitad:</label><select id="nba-dyn1"><option value="${local}">${local}</option><option value="${away}">${away}</option><option>Empate al Medio Tiempo</option></select>`;break;
      case 'Puntos 1H':box.innerHTML=`<div class="row"><div class="col"><label>Dir.:</label><select id="nba-dyn1"><option>MÃ¡s de (+)</option><option>Menos de (-)</option></select></div><div class="col"><label>LÃ­nea 1Âª Mitad:</label><select id="nba-dyn2">${hL}</select></div></div>`;break;
      case 'Ganador Cuarto':box.innerHTML=`<label>Cuarto:</label><select id="nba-dyn1"><option>1er Cuarto</option><option>2do Cuarto</option><option>3er Cuarto</option><option>4to Cuarto</option></select><label>Ganador:</label><select id="nba-dyn2"><option value="${local}">${local}</option><option value="${away}">${away}</option></select>`;break;
      case 'Puntos Cuarto':box.innerHTML=`<label>Cuarto:</label><select id="nba-dyn1"><option>1er Cuarto</option><option>2do Cuarto</option><option>3er Cuarto</option><option>4to Cuarto</option></select><div class="row" style="margin-top:8px"><div class="col"><label>Dir.:</label><select id="nba-dyn2"><option>MÃ¡s de (+)</option><option>Menos de (-)</option></select></div><div class="col"><label>LÃ­nea:</label><select id="nba-dyn3">${qL}</select></div></div>`;break;
      case 'Props Jugador':box.innerHTML=`<label>Jugador:</label><input type="text" id="nba-dyn1" placeholder="Nombre del jugador"><label>EstadÃ­stica:</label><select id="nba-dyn2"><option>Puntos</option><option>Rebotes</option><option>Asistencias</option><option>PRA (Pts+Reb+Ast)</option><option>Robos</option><option>Bloqueos</option><option>Triples anotados</option><option>Robos+Bloqueos</option></select><div class="row" style="margin-top:8px"><div class="col"><label>Dir.:</label><select id="nba-dyn3"><option>MÃ¡s de (+)</option><option>Menos de (-)</option></select></div><div class="col"><label>LÃ­nea:</label><input type="number" step="0.5" id="nba-dyn4" placeholder="Ej: 25.5"></div></div>`;break;
      case 'Doble Doble':box.innerHTML=`<label>Jugador:</label><input type="text" id="nba-dyn1" placeholder="Nombre del jugador"><label>Â¿LograrÃ¡ un Doble-Doble?</label><select id="nba-dyn2"><option>SÃ­</option><option>No</option></select>`;break;
      case 'Triple Doble':box.innerHTML=`<label>Jugador:</label><input type="text" id="nba-dyn1" placeholder="Nombre del jugador"><label>Â¿LograrÃ¡ un Triple-Doble?</label><select id="nba-dyn2"><option>SÃ­</option><option>No</option></select>`;break;
      default:box.innerHTML=`<label>SelecciÃ³n:</label><select id="nba-dyn1"><option value="${local}">${local}</option><option value="${away}">${away}</option></select><label>LÃ­nea (si aplica):</label><input type="text" id="nba-dyn2" placeholder="Ej: â€“5.5">`;
    }
  }
}
function updateCornersLines(){const sel=document.getElementById('dyn-sel1')?.value;const lines=sel==='total'?genLines(0.5,15.5):genLines(0.5,10.5);const el=document.getElementById('dyn-sel3');if(el)el.innerHTML=lineOpts(lines);}

function buildDetails(p,market){
  try{
    const g=id=>document.getElementById(id)?.value||'';
    if(p==='fb'){
      if(['1X2','Doble Oportunidad','Ambos Marcan','Personalizado'].includes(market))return g('dyn-sel1');
      if(['Goles','Goles 1H'].includes(market))return`${market} ${g('dyn-sel1')} | ${g('dyn-sel2')} ${g('dyn-sel3')}`;
      if(market==='Corners')return`Corners ${g('dyn-sel1')} | ${g('dyn-sel2')} ${g('dyn-sel3')}`;
      if(market==='Tarjetas')return`${g('dyn-sel2')} ${g('dyn-sel1')} | ${g('dyn-sel3')} ${g('dyn-sel4')}`;
      if(market==='Jugador')return`${g('dyn-sel1')} | ${g('dyn-sel2')} ${g('dyn-sel3')} ${g('dyn-sel4')}`;
      if(market==='Handicap')return`HÃ¡ndicap ${g('dyn-sel1')} ${g('dyn-sel2')}`;
      if(market==='Handicap Asiatico')return`H.AsiÃ¡tico ${g('dyn-sel1')} ${g('dyn-sel2')}`;
      if(market==='Resultado Exacto')return`Resultado: ${g('dyn-sel1')}`;
      return g('dyn-sel1');
    }else{
      if(market==='Ganador')return`ML: ${g('nba-dyn1')}`;
      if(market==='Handicap')return`Spread: ${g('nba-dyn1')} ${g('nba-dyn2')}`;
      if(market==='Puntos Totales')return`Puntos ${g('nba-dyn1')} ${g('nba-dyn2')}`;
      if(market==='Ganador 1H')return`1ÂªMitad: ${g('nba-dyn1')}`;
      if(market==='Puntos 1H')return`Pts 1ÂªMitad ${g('nba-dyn1')} ${g('nba-dyn2')}`;
      if(market==='Ganador Cuarto')return`${g('nba-dyn1')}: ${g('nba-dyn2')}`;
      if(market==='Puntos Cuarto')return`${g('nba-dyn1')} Pts ${g('nba-dyn2')} ${g('nba-dyn3')}`;
      if(market==='Props Jugador')return`${g('nba-dyn1')} | ${g('nba-dyn2')} ${g('nba-dyn3')} ${g('nba-dyn4')}`;
      if(['Doble Doble','Triple Doble'].includes(market))return`${market}: ${g('nba-dyn1')} â€“ ${g('nba-dyn2')}`;
      return g('nba-dyn1')||market;
    }
  }catch(e){return market;}
}

function saveBet(sportName){
  const p=sportName==='FÃºtbol'?'fb':'nba';
  const local=document.getElementById(`${p}-local`).value,away=document.getElementById(`${p}-away`).value;
  const market=document.getElementById(`${p}-market`).value,stake=document.getElementById(`${p}-stake`).value;
  const odds=parseFloat(document.getElementById(`${p}-odds`).value),money=parseFloat(document.getElementById(`${p}-money`).value);
  const result=document.getElementById(`${p}-result`).value,notes=document.getElementById(`${p}-notes`).value.trim();
  if(!local||!away||!market||isNaN(odds)||!money)return alert("âš ï¸ Completa todos los campos.");
  const details=buildDetails(p,market);
  let profit=0;
  if(result==='Ganada'){profit=Math.round(money*odds-money);appData.bank+=profit;}
  else if(result==='Perdida'){profit=-money;appData.bank-=money;}
  appData.history.push({id:Date.now(),sport:sportName,match:`${local} vs ${away}`,details,notes,stake,odds,money,result,profit,date:new Date().toLocaleDateString('es-CO')});
  saveUserData();clearForm(p);updateQuickStats();drawChart();
  alert(`âœ… Apuesta registrada!\nBankroll: $${appData.bank.toLocaleString('es-CO')}`);
}
function clearForm(p){
  const el=n=>document.getElementById(n);
  if(el(`${p}-odds`))el(`${p}-odds`).value='';
  if(el(`${p}-notes`))el(`${p}-notes`).value='';
  if(el(`${p}-result`))el(`${p}-result`).value='Pendiente';
  if(el(`${p}-dynamic-container`))el(`${p}-dynamic-container`).innerHTML='';
  if(el(`${p}-market`))el(`${p}-market`).value='';
}

function renderHistory(filter,btn){
  if(btn){document.querySelectorAll('.filters button').forEach(b=>b.classList.remove('active-filter'));btn.classList.add('active-filter');}
  const list=document.getElementById('history-list');list.innerHTML='';
  let w=0,l=0,pend=0,ts=0,tp=0;
  appData.history.forEach(h=>{if(h.result==='Ganada'){w++;ts+=h.money;tp+=h.profit;}else if(h.result==='Perdida'){l++;ts+=h.money;tp+=h.profit;}else if(h.result==='Pendiente')pend++;});
  const filtered=filter==='Todas'?[...appData.history]:appData.history.filter(h=>h.result===filter);
  if(!filtered.length)list.innerHTML='<p style="text-align:center;color:var(--text-muted);padding:28px 0">No hay apuestas en esta categorÃ­a</p>';
  filtered.slice().reverse().forEach(h=>{
    const sc=h.result==='Ganada'?'win':(h.result==='Perdida'?'loss':(h.result==='Nula'?'void':''));
    const pc=h.profit>0?'var(--success)':(h.profit<0?'var(--danger)':'gray');
    const isPending=h.result==='Pendiente',isCombi=h.type==='Combinada';
    const combiBlock=isCombi&&h.selections?`<div class="combi-picks">${h.selections.map((s,i)=>`<div class="combi-pick-row"><span>${i+1}. ${s.match} â€” ${s.pick}</span><span class="combi-sel-odds">@${parseFloat(s.odds).toFixed(2)}</span></div>`).join('')}</div>`:'';
    list.innerHTML+=`<div class="history-item ${sc}" id="bet-${h.id}">
      <div class="h-head"><span>${h.date} Â· ${h.sport}</span><b>Stake ${h.stake}</b></div>
      <div class="h-title">${h.match}</div>${combiBlock}
      <span class="h-detail">â–¶ ${h.details}</span>
      ${h.notes?`<div class="nota-display">ğŸ“ ${h.notes}</div>`:''}
      <div class="h-foot"><span>InversiÃ³n: $${h.money.toLocaleString('es-CO')}</span><span>Cuota: @${parseFloat(h.odds).toFixed(2)}</span></div>
      ${!isPending?`<div class="h-profit" style="color:${pc}">${h.result}: ${h.profit>=0?'+':''}$${h.profit.toLocaleString('es-CO')}</div>`:''}
      <div class="h-actions">
        ${isPending?`<button class="btn-success" onclick="resolvebet(${h.id},'Ganada')">âœ… Ganada</button><button class="btn-danger" onclick="resolvebet(${h.id},'Perdida')">âŒ Perdida</button><button onclick="resolvebet(${h.id},'Nula')" style="background:var(--void)">ğŸ”„ Nula</button>`:''}
        <button onclick="deleteBet(${h.id})" class="btn-secondary">ğŸ—‘ Borrar</button>
      </div>
    </div>`;
  });
  const resolved=w+l,yieldP=ts>0?((tp/ts)*100).toFixed(2):0,wr=resolved>0?((w/resolved)*100).toFixed(1):0;
  document.getElementById('st-won').innerText=w;document.getElementById('st-lost').innerText=l;
  document.getElementById('st-pending').innerText=pend;document.getElementById('st-total').innerText=appData.history.length;
  document.getElementById('st-yield').innerText=yieldP+'%';document.getElementById('st-winrate').innerText=wr+'%';
  document.getElementById('st-profit').innerText='$'+tp.toLocaleString('es-CO');
  document.getElementById('st-yield').style.color=parseFloat(yieldP)>=0?'var(--success)':'var(--danger)';
  document.getElementById('st-profit').style.color=tp>=0?'var(--success)':'var(--danger)';
}
function resolvebet(id,newResult){
  const idx=appData.history.findIndex(h=>h.id===id);if(idx<0)return;
  const h=appData.history[idx],money=h.money,odds=h.odds;let np=0;
  if(newResult==='Ganada'){np=Math.round(money*odds-money);appData.bank+=np;}
  else if(newResult==='Perdida'){np=-money;appData.bank-=money;}
  appData.history[idx].result=newResult;appData.history[idx].profit=np;
  saveUserData();renderHistory('Todas',null);updateQuickStats();drawChart();
}
function deleteBet(id){if(!confirm("Â¿Eliminar esta apuesta?"))return;appData.history=appData.history.filter(h=>h.id!==id);saveUserData();renderHistory('Todas',null);updateQuickStats();drawChart();}
function resetHistory(){if(confirm("âš ï¸ Â¿Eliminar historial y reiniciar bankroll a 0?")){appData.history=[];appData.bank=0;appData.bankLog=[];saveUserData();renderHistory('Todas',null);updateQuickStats();drawChart();}}

function updateQuickStats(){
  const qs=document.getElementById('quick-stats');
  if(!appData.history.length){qs.style.display='none';return;}qs.style.display='flex';
  let w=0,ts=0,tp=0;
  appData.history.forEach(h=>{if(h.result==='Ganada'){w++;ts+=h.money;tp+=h.profit;}else if(h.result==='Perdida'){ts+=h.money;tp+=h.profit;}});
  const resolved=appData.history.filter(h=>['Ganada','Perdida'].includes(h.result)).length;
  const yP=ts>0?((tp/ts)*100).toFixed(1):0,wr=resolved>0?((w/resolved)*100).toFixed(0):0;
  document.getElementById('qs-yield').innerText=yP+'%';document.getElementById('qs-wr').innerText=wr+'%';
  document.getElementById('qs-count').innerText=appData.history.length;document.getElementById('qs-profit').innerText='$'+tp.toLocaleString('es-CO');
  document.getElementById('qs-yield').style.color=parseFloat(yP)>=0?'var(--success)':'var(--danger)';
  document.getElementById('qs-profit').style.color=tp>=0?'var(--success)':'var(--danger)';
}

let combiSelections=[];
function addCombiSelection(){
  const idx=combiSelections.length;combiSelections.push({match:'',pick:'',odds:'',sport:'FÃºtbol'});
  const container=document.getElementById('combi-selections');
  const div=document.createElement('div');div.className='combi-sel-card';div.id=`combi-sel-${idx}`;
  const leagueOpts=Object.keys(DB.football).map(l=>`<option value="${l}">${l}</option>`).join('');
  const nbaOpts=DB.nba.sort().map(t=>`<option value="${t}">${t}</option>`).join('');
  div.innerHTML=`<div class="combi-num">SEL. ${idx+1}</div><button class="remove-btn" onclick="removeCombiSelection(${idx})">âœ•</button>
    <label>Deporte</label><select onchange="onCombiSportChange(this,${idx})" id="combi-sport-${idx}" style="margin-bottom:8px"><option value="FÃºtbol">âš½ FÃºtbol</option><option value="NBA">ğŸ€ NBA</option></select>
    <div id="combi-teams-${idx}">
      <label>Liga</label><select id="combi-league-${idx}" onchange="loadCombiTeams(${idx})" style="margin-bottom:7px">${leagueOpts}</select>
      <div style="display:flex;gap:8px">
        <div style="flex:1"><label>Local</label><select id="combi-local-${idx}" onchange="updateCombiMatch(${idx})" style="margin-bottom:7px"></select></div>
        <div style="flex:1"><label>Visitante</label><select id="combi-away-${idx}" onchange="updateCombiMatch(${idx})" style="margin-bottom:7px"></select></div>
      </div>
    </div>
    <label>Tu Pick</label><input type="text" placeholder="Ej: Gana Real Madrid, MÃ¡s de 2.5..." oninput="combiSelections[${idx}].pick=this.value" id="combi-pick-${idx}">
    <label>Cuota (@)</label><input type="number" step="0.01" placeholder="Ej: 1.80" id="combi-odds-${idx}" oninput="combiSelections[${idx}].odds=parseFloat(this.value)||'';updateCombiOdds()">`;
  container.appendChild(div);loadCombiTeams(idx);updateCombiOdds();
}
function onCombiSportChange(sel,idx){
  combiSelections[idx].sport=sel.value;
  const td=document.getElementById(`combi-teams-${idx}`);
  const nbaOpts=DB.nba.sort().map(t=>`<option value="${t}">${t}</option>`).join('');
  const leagueOpts=Object.keys(DB.football).map(l=>`<option value="${l}">${l}</option>`).join('');
  if(sel.value==='NBA'){td.innerHTML=`<div style="display:flex;gap:8px"><div style="flex:1"><label>Local</label><select id="combi-local-${idx}" onchange="updateCombiMatch(${idx})" style="margin-bottom:7px">${nbaOpts}</select></div><div style="flex:1"><label>Visitante</label><select id="combi-away-${idx}" onchange="updateCombiMatch(${idx})" style="margin-bottom:7px">${nbaOpts}</select></div></div>`;}
  else{td.innerHTML=`<label>Liga</label><select id="combi-league-${idx}" onchange="loadCombiTeams(${idx})" style="margin-bottom:7px">${leagueOpts}</select><div style="display:flex;gap:8px"><div style="flex:1"><label>Local</label><select id="combi-local-${idx}" onchange="updateCombiMatch(${idx})" style="margin-bottom:7px"></select></div><div style="flex:1"><label>Visitante</label><select id="combi-away-${idx}" onchange="updateCombiMatch(${idx})" style="margin-bottom:7px"></select></div></div>`;loadCombiTeams(idx);}
  updateCombiMatch(idx);
}
function loadCombiTeams(idx){const le=document.getElementById(`combi-league-${idx}`);if(!le)return;const opts=(DB.football[le.value]||[]).map(t=>`<option value="${t}">${t}</option>`).join('');['combi-local-','combi-away-'].forEach(p=>{const el=document.getElementById(p+idx);if(el)el.innerHTML=opts;});updateCombiMatch(idx);}
function updateCombiMatch(idx){const l=document.getElementById(`combi-local-${idx}`)?.value||'',a=document.getElementById(`combi-away-${idx}`)?.value||'';if(l&&a)combiSelections[idx].match=`${l} vs ${a}`;}
function removeCombiSelection(idx){
  if(combiSelections.length<=1)return alert("Necesitas al menos una selecciÃ³n.");
  combiSelections.splice(idx,1);const temp=[...combiSelections];combiSelections=[];document.getElementById('combi-selections').innerHTML='';
  temp.forEach((s,i)=>{addCombiSelection();combiSelections[i]={...s};});updateCombiOdds();
}
function updateCombiOdds(){
  const stake=document.getElementById('combi-stake').value,pct=stake*2;
  document.getElementById('combi-stake-val').innerText=stake;document.getElementById('combi-stake-pct').innerText=pct+'%';
  const base=appData.initialBank||appData.bank,money=Math.round(base*(pct/100));
  document.getElementById('combi-money').value=money||'';
  const vO=combiSelections.filter(s=>s.odds>0),tO=vO.reduce((a,s)=>a*s.odds,1),pot=money?Math.round(money*tO):0,cnt=combiSelections.length;
  const sum=document.getElementById('combi-summary');
  if(cnt>0){sum.style.display='block';document.getElementById('combi-count').innerText=cnt+' selecc.';document.getElementById('combi-total-odds').innerText=tO.toFixed(2);document.getElementById('combi-potential').innerText=pot>0?'$'+pot.toLocaleString('es-CO'):'$0';}
  else sum.style.display='none';
}
function saveCombi(){
  const money=parseFloat(document.getElementById('combi-money').value),result=document.getElementById('combi-result').value;
  const stake=document.getElementById('combi-stake').value,notes=document.getElementById('combi-notes').value.trim();
  combiSelections.forEach((_,i)=>updateCombiMatch(i));
  const vs=combiSelections.filter(s=>s.match&&s.pick&&s.odds>0);
  if(vs.length<2)return alert("âš ï¸ Necesitas al menos 2 selecciones completas.");
  if(!money)return alert("âš ï¸ Establece tu Bankroll primero.");
  const tO=parseFloat(vs.reduce((a,s)=>a*s.odds,1).toFixed(2));
  let profit=0;if(result==='Ganada'){profit=Math.round(money*tO-money);appData.bank+=profit;}else if(result==='Perdida'){profit=-money;appData.bank-=money;}
  appData.history.push({id:Date.now(),type:'Combinada',sport:'ğŸ° Combinada',match:`Combinada ${vs.length} sels.`,details:`Cuota total: @${tO}`,notes,selections:vs.map(s=>({match:s.match,pick:s.pick,odds:s.odds,sport:s.sport})),totalOdds:tO,stake,odds:tO,money,result,profit,date:new Date().toLocaleDateString('es-CO')});
  saveUserData();clearCombi();updateQuickStats();drawChart();alert(`âœ… Combinada guardada! @${tO}\nBankroll: $${appData.bank.toLocaleString('es-CO')}`);
}
function clearCombi(){combiSelections=[];document.getElementById('combi-selections').innerHTML='';document.getElementById('combi-result').value='Pendiente';document.getElementById('combi-stake').value=1;document.getElementById('combi-notes').value='';document.getElementById('combi-summary').style.display='none';addCombiSelection();}

function renderRetoTemplates(){
  document.getElementById('reto-template-list').innerHTML=Object.entries(RETO_TEMPLATES).map(([key,t])=>`
    <div class="reto-template-card" onclick="selectRetoTemplate('${key}')">
      <div class="reto-tmpl-header"><div class="reto-tmpl-badge" style="color:${t.color}">Ã—${t.mult}</div><div class="reto-tmpl-name">${t.label}</div></div>
      <div class="reto-tmpl-desc">${t.desc}</div>
      <div><span class="reto-tmpl-tag">ğŸ¯ ${t.cuotaRec}</span><span class="reto-tmpl-tag">ğŸ’° ${t.stakeRec}</span><span class="reto-tmpl-tag">ğŸ“Š ${t.pasos}</span></div>
    </div>`).join('');
}
function selectRetoTemplate(type){
  if(appData.activeReto)return alert("Ya tienes un reto activo. TermÃ­nalo o abandÃ³nalo primero.");
  pendingRetoType=type;const t=RETO_TEMPLATES[type];
  document.getElementById('reto-setup-title').innerText=`Configurar Reto Ã—${t.mult}`;
  document.getElementById('reto-initial').value=appData.bank>0?appData.bank:'';
  document.getElementById('reto-setup-info').innerHTML=`<b style="color:var(--primary)">Ã—${t.mult} â€“ ${t.desc}</b><br><br>${t.tips[0]}<br>${t.tips[1]}`;
  document.getElementById('reto-initial').oninput=()=>{const v=parseFloat(document.getElementById('reto-initial').value)||0;const goal=v*t.mult;const el=document.getElementById('reto-goal-preview');if(el)el.innerText=goal>0?'$'+goal.toLocaleString('es-CO'):'calculando...';};
  const infoBox=document.getElementById('reto-setup-info');
  infoBox.innerHTML+=`<br><br>Con el monto que ingreses, tu meta serÃ¡ <b id="reto-goal-preview">calculando...</b>`;
  document.getElementById('reto-home').style.display='none';document.getElementById('reto-setup-view').style.display='block';
}
function cancelRetoSetup(){pendingRetoType=null;document.getElementById('reto-setup-view').style.display='none';document.getElementById('reto-home').style.display='block';}
function startReto(){
  const name=document.getElementById('reto-name').value.trim()||`Reto ${pendingRetoType}`;
  const initial=parseFloat(document.getElementById('reto-initial').value);
  const sport=document.getElementById('reto-sport').value;
  if(!initial||initial<=0)return alert("Ingresa un monto inicial vÃ¡lido.");
  const t=RETO_TEMPLATES[pendingRetoType];
  appData.activeReto={id:Date.now(),name,type:pendingRetoType,multiplier:t.mult,initialBank:initial,goalBank:Math.round(initial*t.mult),currentBank:initial,sport,startDate:new Date().toLocaleDateString('es-CO'),bets:[],status:'active'};
  saveUserData();document.getElementById('reto-setup-view').style.display='none';renderRetoView();
}
function renderRetoView(){
  const reto=appData.activeReto;
  const homeDiv=document.getElementById('reto-home'),activeDiv=document.getElementById('reto-active-view');
  document.getElementById('reto-setup-view').style.display='none';
  if(!reto){
    homeDiv.style.display='block';activeDiv.style.display='none';
    const pastCard=document.getElementById('reto-past-card'),pastList=document.getElementById('reto-past-list');
    if(appData.retoHistory&&appData.retoHistory.length>0){
      pastCard.style.display='block';
      pastList.innerHTML=appData.retoHistory.slice().reverse().map(r=>{
        const ok=r.status==='completed';
        return`<div class="reto-past-item ${r.status}">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <b style="color:${ok?'var(--success)':'var(--danger)'}">${ok?'âœ…':'âŒ'} ${r.name} Ã—${r.multiplier}</b>
            <span style="font-size:0.72rem;color:var(--text-muted)">${r.startDate}</span>
          </div>
          <div style="font-size:0.78rem;color:var(--text-muted);margin-top:4px">
            Inicio: $${r.initialBank.toLocaleString('es-CO')} â†’ Final: <b style="color:${ok?'var(--success)':'var(--danger)'}">$${r.currentBank.toLocaleString('es-CO')}</b> Â· ${r.bets.length} apuesta${r.bets.length!==1?'s':''}
          </div>
        </div>`;
      }).join('');
    }else pastCard.style.display='none';
    return;
  }
  homeDiv.style.display='none';activeDiv.style.display='block';
  const pct=Math.min((reto.currentBank/reto.goalBank)*100,100);
  document.getElementById('reto-current-display').innerText='$'+reto.currentBank.toLocaleString('es-CO');
  document.getElementById('reto-goal-display').innerText='$'+reto.goalBank.toLocaleString('es-CO');
  document.getElementById('reto-active-name').innerText=`${reto.name} (Ã—${reto.multiplier})`;
  document.getElementById('reto-progress-pct').innerText=pct.toFixed(1)+'%';
  document.getElementById('reto-progress-fill').style.width=pct+'%';
  document.getElementById('reto-start-label').innerText='$'+reto.initialBank.toLocaleString('es-CO');
  document.getElementById('reto-end-label').innerText='$'+reto.goalBank.toLocaleString('es-CO');
  const t=RETO_TEMPLATES[reto.type];
  document.getElementById('reto-tips-content').innerHTML=t.tips.map(tip=>`<div class="consejo-card" style="margin-bottom:7px"><p style="color:var(--text-dark)">ğŸ’¡ ${tip}</p></div>`).join('');
  const betsList=document.getElementById('reto-bets-list');
  if(!reto.bets.length){betsList.innerHTML='<p style="color:var(--text-muted);font-size:0.83rem;text-align:center;padding:14px 0">Sin apuestas todavÃ­a</p>';}
  else{betsList.innerHTML=reto.bets.slice().reverse().map(b=>{const sc=b.result==='Ganada'?'win':(b.result==='Perdida'?'loss':'');const pc=b.profit>0?'var(--success)':(b.profit<0?'var(--danger)':'gray');return`<div class="reto-bet-item ${sc}"><div style="display:flex;justify-content:space-between"><b>${b.match}</b><span style="font-size:0.78rem;color:var(--text-muted)">@${parseFloat(b.odds).toFixed(2)}</span></div><div style="font-size:0.78rem;color:var(--primary);margin:2px 0">â–¶ ${b.pick}</div><div style="display:flex;justify-content:space-between;font-size:0.76rem;color:var(--text-muted)"><span>$${b.amount.toLocaleString('es-CO')}</span><span style="font-weight:700;color:${pc}">${b.result==='Pendiente'?'â³ Pendiente':`${b.result}: ${b.profit>=0?'+':''}$${b.profit.toLocaleString('es-CO')}`}</span></div></div>`;}).join('');}
}
function addRetoBet(){
  const reto=appData.activeReto;if(!reto)return;
  const match=document.getElementById('reto-match').value.trim(),pick=document.getElementById('reto-pick').value.trim();
  const odds=parseFloat(document.getElementById('reto-odds').value),amount=parseFloat(document.getElementById('reto-bet-amount').value);
  const result=document.getElementById('reto-result').value;
  if(!match||!pick||isNaN(odds)||!amount)return alert("âš ï¸ Completa todos los campos.");
  if(amount>reto.currentBank)return alert("âš ï¸ El monto supera el bank del reto.");
  let profit=0;
  if(result==='Ganada'){profit=Math.round(amount*odds-amount);reto.currentBank+=profit;}
  else if(result==='Perdida'){profit=-amount;reto.currentBank-=amount;}
  reto.bets.push({id:Date.now(),match,pick,odds,amount,result,profit,date:new Date().toLocaleDateString('es-CO')});
  ['reto-match','reto-pick','reto-odds','reto-bet-amount'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('reto-result').value='Pendiente';
  if(reto.currentBank<=0){
    reto.currentBank=0;reto.status='failed';
    appData.retoHistory.push({...reto,endDate:new Date().toLocaleDateString('es-CO')});
    appData.activeReto=null;saveUserData();
    document.getElementById('reto-lose-desc').innerText=`Fallaste el reto "${reto.name}" (Ã—${reto.multiplier}) tras ${reto.bets.length} apuesta${reto.bets.length!==1?'s':''}. Â¡Analiza y vuelve mÃ¡s fuerte!`;
    document.getElementById('reto-lose-modal').classList.add('show');renderRetoView();return;
  }
  if(reto.currentBank>=reto.goalBank){
    reto.status='completed';
    appData.retoHistory.push({...reto,endDate:new Date().toLocaleDateString('es-CO')});
    appData.activeReto=null;saveUserData();
    document.getElementById('reto-win-title').innerText=`Â¡Reto ${reto.name} completado!`;
    document.getElementById('reto-win-desc').innerText=`Empezaste con $${reto.initialBank.toLocaleString('es-CO')} y llegaste a $${reto.currentBank.toLocaleString('es-CO')} en ${reto.bets.length} apuesta${reto.bets.length!==1?'s':''}. Â¡Disciplina y paciencia ganaron!`;
    document.getElementById('reto-win-modal').classList.add('show');renderRetoView();return;
  }
  saveUserData();renderRetoView();
}
function abandonReto(){if(!confirm("Â¿Abandonar el reto? Se guardarÃ¡ como fallado."))return;const r=appData.activeReto;r.status='failed';appData.retoHistory.push({...r,endDate:new Date().toLocaleDateString('es-CO')});appData.activeReto=null;saveUserData();renderRetoView();}
function restartReto(){const lr=appData.retoHistory[appData.retoHistory.length-1];['reto-win-modal','reto-lose-modal'].forEach(id=>document.getElementById(id).classList.remove('show'));if(lr){pendingRetoType=lr.type;selectRetoTemplate(lr.type);document.getElementById('reto-name').value=lr.name;document.getElementById('reto-initial').value=lr.initialBank;}navTo('view-reto');}
function endReto(){['reto-win-modal','reto-lose-modal'].forEach(id=>document.getElementById(id).classList.remove('show'));navTo('view-reto');}

const CONSEJOS_FIJOS=[
  {tipo:'default',titulo:'ğŸ“ Flat Staking',texto:'Siempre calculas sobre el bankroll inicial. Evita distorsiÃ³n por rachas.'},
  {tipo:'default',titulo:'ğŸ¯ El Yield es tu norte',texto:'Yield sostenido 5â€“8% = excelente. Por encima del 10% a largo plazo = sobresaliente.'},
  {tipo:'warning',titulo:'âš ï¸ Cuidado con el Tilt',texto:'Si pierdes 3 seguidas, para. Las peores decisiones llegan intentando recuperar pÃ©rdidas rÃ¡pido.'},
  {tipo:'default',titulo:'ğŸ“… EspecialÃ­zate',texto:'Domina 1 o 2 ligas. Conocimiento profundo vale mÃ¡s que apostar en todo.'},
  {tipo:'success',titulo:'âœ… Registra tu razonamiento',texto:'Usa "Notas" antes de cada apuesta. Revisar tu lÃ³gica despuÃ©s del partido acelera tu aprendizaje.'},
  {tipo:'warning',titulo:'ğŸ° Cuidado con las combinadas',texto:'Multiplican la cuota pero tambiÃ©n el riesgo. Un fallo = todo perdido. Ãšsalas con moderaciÃ³n.'},
];

function renderAnalisis(){
  const resolved=appData.history.filter(h=>['Ganada','Perdida'].includes(h.result));
  const bwEl=document.getElementById('analisis-bestworse');
  if(!resolved.length){bwEl.innerHTML='<p style="color:var(--text-muted);font-size:0.83rem;text-align:center;padding:14px 0">Sin apuestas resueltas</p>';}
  else{
    const best=resolved.reduce((a,b)=>b.profit>a.profit?b:a),worst=resolved.reduce((a,b)=>b.profit<a.profit?b:a);
    const bwItem=(h,tipo)=>{const ok=tipo==='best',color=ok?'var(--success)':'var(--danger)',label=ok?'ğŸ† Mejor':'ğŸ’€ Peor';return`<div class="bw-item" style="border-color:${color}40"><div class="bw-label" style="color:${color}">${label}</div><div class="bw-match">${h.match}</div><div class="bw-meta">${h.date} Â· @${parseFloat(h.odds).toFixed(2)}</div><div class="bw-profit" style="color:${color}">${h.profit>=0?'+':''}$${h.profit.toLocaleString('es-CO')}</div></div>`;};
    bwEl.innerHTML=`<div class="best-worst-card">${bwItem(best,'best')}${bwItem(worst,'worst')}</div>`;
  }
  const rE=document.getElementById('racha-emoji'),rT=document.getElementById('racha-texto'),rS=document.getElementById('racha-sub');
  if(!resolved.length){rE.innerText='â€”';rT.innerText='Sin apuestas resueltas';rS.innerText='';}
  else{
    let cnt=1,tipo=resolved[resolved.length-1].result;
    for(let i=resolved.length-2;i>=0;i--){if(resolved[i].result===tipo)cnt++;else break;}
    const last10=resolved.slice(-10);
    const dots=last10.map(h=>`<div class="racha-dot" style="background:${h.result==='Ganada'?'var(--success)':'var(--danger)'}">${h.result==='Ganada'?'G':'P'}</div>`).join('');
    if(tipo==='Ganada'){rE.innerText=cnt>=3?'ğŸ”¥':'âœ…';rT.innerText=`Racha ganadora de ${cnt}`;rT.style.color='var(--success)';rS.innerText=cnt>=3?'Â¡MantÃ©n la disciplina!':'Vas bien.';}
    else{rE.innerText=cnt>=3?'â„ï¸':'âŒ';rT.innerText=`Racha perdedora de ${cnt}`;rT.style.color='var(--danger)';rS.innerText=cnt>=3?'âš ï¸ Para y revisa tu metodologÃ­a.':'Normal en el proceso.';}
    let dotDiv=document.getElementById('racha-dots');
    if(!dotDiv){dotDiv=document.createElement('div');dotDiv.id='racha-dots';dotDiv.className='racha-badge';document.getElementById('racha-display').appendChild(dotDiv);}
    dotDiv.innerHTML=dots;
  }
  const deportesEl=document.getElementById('analisis-deportes');
  const sports=['FÃºtbol','NBA','ğŸ° Combinada'];
  const sd=sports.map(s=>{const bets=resolved.filter(h=>h.sport===s||(s==='ğŸ° Combinada'&&h.type==='Combinada'));const won=bets.filter(h=>h.result==='Ganada').length;const ts=bets.reduce((a,h)=>a+h.money,0),tp=bets.reduce((a,h)=>a+h.profit,0);const y=ts>0?(tp/ts*100):null,wr=bets.length>0?(won/bets.length*100):0;return{sport:s,count:bets.length,won,y,tp,wr};}).filter(s=>s.count>0);
  if(!sd.length)deportesEl.innerHTML='<p style="color:var(--text-muted);font-size:0.83rem;text-align:center;padding:14px 0">Registra apuestas para ver estadÃ­sticas</p>';
  else deportesEl.innerHTML=sd.map(s=>{const yc=s.y===null?'var(--text-muted)':(s.y>=0?'var(--success)':'var(--danger)');const ys=s.y===null?'N/A':`${s.y>=0?'+':''}${s.y.toFixed(1)}%`;const bc=s.wr>=55?'var(--success)':(s.wr>=45?'var(--void)':'var(--danger)');return`<div class="analisis-sport-row"><div class="analisis-sport-head"><span class="analisis-sport-name">${s.sport}</span><span class="analisis-sport-meta">${s.count} apuesta${s.count>1?'s':''}</span></div><div class="analisis-bar-track"><div class="analisis-bar-fill" style="width:${Math.min(s.wr,100)}%;background:${bc}"></div></div><div class="analisis-sport-stats"><span>Acierto: <b>${s.wr.toFixed(0)}%</b></span><span>Yield: <b style="color:${yc}">${ys}</b></span><span>P&G: <b style="color:${s.tp>=0?'var(--success)':'var(--danger)'}">${s.tp>=0?'+':''}$${s.tp.toLocaleString('es-CO')}</b></span></div></div>`;}).join('');
  const ligasEl=document.getElementById('analisis-ligas');
  const fbBets=resolved.filter(h=>h.sport==='FÃºtbol');
  const mktMap={'1X2':d=>d.startsWith('Gana')||d==='Empate','Goles':d=>d.includes('Goles'),'Corners':d=>d.includes('Corner'),'Tarjetas':d=>d.includes('Tarjeta'),'HÃ¡ndicap':d=>d.includes('HÃ¡ndicap'),'Ambos Marcan':d=>d.includes('Ambos')};
  const mktData=Object.entries(mktMap).map(([m,fn])=>{const bets=fbBets.filter(h=>fn(h.details||''));if(!bets.length)return null;const won=bets.filter(h=>h.result==='Ganada').length;const ts=bets.reduce((a,h)=>a+h.money,0),tp=bets.reduce((a,h)=>a+h.profit,0);const y=ts>0?(tp/ts*100):null;return{name:m,count:bets.length,won,y,tp};}).filter(Boolean).sort((a,b)=>(b.y||0)-(a.y||0));
  if(!mktData.length)ligasEl.innerHTML='<p style="color:var(--text-muted);font-size:0.83rem;text-align:center;padding:14px 0">Sin apuestas de fÃºtbol resueltas</p>';
  else ligasEl.innerHTML=mktData.map(m=>{const yc=m.y===null?'var(--text-muted)':(m.y>=0?'var(--success)':'var(--danger)');const ys=m.y===null?'N/A':`${m.y>=0?'+':''}${m.y.toFixed(1)}%`;return`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed var(--border)"><div><div style="font-weight:700;font-size:0.86rem;color:var(--text-dark)">${m.name}</div><div style="font-size:0.7rem;color:var(--text-muted)">${m.count} apuesta${m.count>1?'s':''} Â· ${m.won} ganadas</div></div><div style="text-align:right"><div style="font-weight:800;color:${yc};font-size:0.93rem">${ys}</div><div style="font-size:0.7rem;color:${m.tp>=0?'var(--success)':'var(--danger)'}">P&G ${m.tp>=0?'+':''}$${m.tp.toLocaleString('es-CO')}</div></div></div>`;}).join('');
  const consejosEl=document.getElementById('consejos-list');const din=[...CONSEJOS_FIJOS];
  if(resolved.length>=5){const ts=resolved.reduce((a,h)=>a+h.money,0),tp=resolved.reduce((a,h)=>a+h.profit,0);const gy=ts>0?(tp/ts*100):0,w=resolved.filter(h=>h.result==='Ganada').length,wr=w/resolved.length*100;if(gy<-10)din.unshift({tipo:'danger',titulo:'ğŸš¨ Yield negativo',texto:`Tu yield es ${gy.toFixed(1)}%. Pausa y revisa en quÃ© mercados fallas.`});else if(gy>10)din.unshift({tipo:'success',titulo:'ğŸŒŸ Yield excelente',texto:`Yield del ${gy.toFixed(1)}%. Â¡MantÃ©n la disciplina!`});if(wr<40)din.unshift({tipo:'warning',titulo:'ğŸ“‰ Tasa de acierto baja',texto:`Aciertas el ${wr.toFixed(0)}% de tus apuestas. Revisa tu metodologÃ­a.`});}
  consejosEl.innerHTML=din.map(c=>`<div class="consejo-card ${c.tipo}"><h4>${c.titulo}</h4><p>${c.texto}</p></div>`).join('');
}

function drawChart(){
  const canvas=document.getElementById('bankroll-chart'),empty=document.getElementById('chart-empty');
  const ctx=canvas.getContext('2d'),W=canvas.offsetWidth||460,H=130;
  canvas.width=W;canvas.height=H;ctx.clearRect(0,0,W,H);
  const res=appData.history.filter(h=>['Ganada','Perdida'].includes(h.result));
  if(res.length<2){empty.style.display='block';canvas.style.display='none';return;}
  empty.style.display='none';canvas.style.display='block';
  let cum=0;const pts=res.map(h=>{cum+=h.profit;return cum;});
  const all=[0,...pts],minV=Math.min(...all),maxV=Math.max(...all),range=maxV-minV||1;
  const pad={t:12,b:12,l:8,r:8},cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;
  const tX=i=>pad.l+(i/(pts.length-1||1))*cW,tY=v=>pad.t+cH-((v-minV)/range)*cH;
  ctx.beginPath();ctx.setLineDash([4,4]);ctx.strokeStyle='rgba(127,127,127,0.3)';ctx.lineWidth=1;ctx.moveTo(pad.l,tY(0));ctx.lineTo(W-pad.r,tY(0));ctx.stroke();ctx.setLineDash([]);
  const lX=tX(pts.length-1),last=pts[pts.length-1],isPos=last>=0;
  ctx.beginPath();ctx.moveTo(tX(0),tY(pts[0]));pts.forEach((v,i)=>{if(i>0)ctx.lineTo(tX(i),tY(v));});ctx.lineTo(lX,H-pad.b);ctx.lineTo(tX(0),H-pad.b);ctx.closePath();
  const g=ctx.createLinearGradient(0,0,0,H);g.addColorStop(0,isPos?'rgba(0,184,148,0.22)':'rgba(214,48,49,0.22)');g.addColorStop(1,'rgba(0,0,0,0)');ctx.fillStyle=g;ctx.fill();
  ctx.beginPath();ctx.moveTo(tX(0),tY(pts[0]));pts.forEach((v,i)=>{if(i>0)ctx.lineTo(tX(i),tY(v));});ctx.strokeStyle=isPos?'#00b894':'#d63031';ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.stroke();
  ctx.beginPath();ctx.arc(lX,tY(last),5,0,Math.PI*2);ctx.fillStyle=isPos?'#00b894':'#d63031';ctx.fill();
  ctx.fillStyle=isPos?'#00b894':'#d63031';ctx.font='bold 11px Segoe UI';ctx.textAlign=lX>W/2?'right':'left';ctx.fillText(`${last>=0?'+':''}$${last.toLocaleString('es-CO')}`,lX,tY(last)-8);
}

function toggleDark(){const d=document.body.classList.toggle('dark');document.getElementById('dark-toggle').innerText=d?'â˜€ï¸':'ğŸŒ™';localStorage.setItem('bmDark',d?'1':'');}
</script>
</body>
</html>